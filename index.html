<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Type spark 9+16 | è‡ªé€‚åº”ä¹å‹äººæ ¼ + MBTI</title>
<meta name="description" content="Type spark 9+16ï¼šä¹å‹äººæ ¼è‡ªé€‚åº”æµ‹è¯„ï¼ˆ9 åŸºç¡€é¢˜ + Top3 è¿½é—®ï¼‰+ MBTI 20 é¢˜ã€‚ç»“æœé¡µå…ˆæ˜¾ç¤ºä¹å‹ï¼Œå†æŸ¥çœ‹ MBTIã€‚åˆ†äº«å›¾ç‰‡åŒæ—¶åŒ…å«ä¹å‹ä¸ MBTIã€‚æ”¯æŒä¸­è‹±æ–‡ã€ç§»åŠ¨ç«¯ã€èƒŒæ™¯éŸ³ä¹ã€‚ä½œè€… Hannahã€‚" />
<style>
  :root{
    --c-blue:#4DA3FF; --c-purple:#8B77FF; --c-orange:#FFB84D; --c-green:#66E3A4; --c-pink:#FF6B9A;
    --c-bg1:#f6f8ff; --c-bg2:#fefaf5; --c-text:#2f2f33; --c-muted:#6b6f76; --c-card:#ffffff;
    --radius:16px; --shadow:0 6px 20px rgba(0,0,0,0.08); --shadow-soft:0 3px 12px rgba(0,0,0,0.06);
    --bar-h:12px; --trans:220ms cubic-bezier(.2,.8,.2,1);
  }
  @media (prefers-color-scheme: dark){
    :root{ --c-bg1:#0f1220; --c-bg2:#191d2d; --c-text:#f2f4fa; --c-muted:#a7abc0; --c-card:#141826;
           --shadow:0 6px 20px rgba(0,0,0,.35); --shadow-soft:0 3px 12px rgba(0,0,0,0.28); }
  }
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    color:var(--c-text);
    background:
      radial-gradient(1200px 600px at 20% -10%, rgba(77,163,255,.20), transparent 60%),
      radial-gradient(900px 600px at 120% 10%, rgba(139,119,255,.18), transparent 55%),
      radial-gradient(700px 500px at 50% 120%, rgba(255,184,77,.18), transparent 50%),
      linear-gradient(180deg,var(--c-bg1),var(--c-bg2));
  }
  .wrap{max-width:980px; margin:0 auto; padding:16px 14px 80px}
  header{
    position:sticky; top:0; z-index:60; backdrop-filter:saturate(1.2) blur(8px);
    background:linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,.5));
    border-bottom:1px solid rgba(0,0,0,.06);
  }
  @media (prefers-color-scheme: dark){
    header{ background:linear-gradient(180deg,rgba(20,24,38,.6),rgba(20,24,38,.35)); border-color:rgba(255,255,255,.08); }
  }
  .h-inner{max-width:980px; margin:0 auto; padding:10px 14px; display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .brand{display:flex; align-items:center; gap:10px;}
  .logo{ width:36px; height:36px; border-radius:10px;
    background: conic-gradient(from 220deg, var(--c-blue), var(--c-purple), var(--c-orange), var(--c-green), var(--c-blue));
    box-shadow: var(--shadow-soft); position:relative; overflow:hidden; }
  .logo::after{content:"âœ¨"; position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:20px; filter:saturate(1.2)}
  .title{font-weight:900; letter-spacing:.3px}
  .subtitle{font-size:12px; color:var(--c-muted)}
  .tools{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .btn, button{ appearance:none; border:none; cursor:pointer; border-radius:12px; padding:10px 14px; font-weight:700;
    color:#fff; background:linear-gradient(180deg,var(--c-blue),#328ef0); box-shadow: var(--shadow);
    transition: transform var(--trans), box-shadow var(--trans), opacity var(--trans);}
  .btn.secondary{ background:linear-gradient(180deg,#8b77ff,#6c59f0); }
  .btn.ghost{ background:transparent; color:var(--c-text); border:1px solid rgba(0,0,0,.12); box-shadow:none; }
  @media (prefers-color-scheme: dark){ .btn.ghost{border-color:rgba(255,255,255,.16); color:#e9ecff;} }
  .btn:active{transform:translateY(1px)}
  .card{ background:var(--c-card); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; margin:14px 0; }
  .grid{display:grid; gap:14px}
  @media(min-width:900px){ .grid.cols-2{ grid-template-columns:1fr 1fr; } }
  .field{display:flex; flex-direction:column; gap:8px}
  .field.inline{flex-direction:row; align-items:center; gap:10px; flex-wrap:wrap}
  label{font-weight:700}
  input[type="text"]{ padding:12px 12px; border-radius:12px; border:1px solid rgba(0,0,0,.12); background:transparent; color:var(--c-text);
    outline:none; transition:border-color var(--trans), box-shadow var(--trans); }
  input[type="text"]:focus{border-color:var(--c-blue); box-shadow:0 0 0 3px rgba(77,163,255,.18)}
  .muted{color:var(--c-muted); font-size:13px}
  .progress{height:10px; background:rgba(0,0,0,.08); border-radius:999px; overflow:hidden}
  .progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--c-green),var(--c-blue)); transition:width 240ms ease}
  .q-card{display:flex; flex-direction:column; gap:10px; position:relative}
  .badge{ position:absolute; top:10px; right:10px; font-size:11px; padding:4px 6px; border-radius:999px; background:#ffe082; color:#3a2d00; }
  .scale{display:flex; gap:6px; flex-wrap:wrap}
  .chip{ padding:8px 10px; border-radius:12px; border:1px solid rgba(0,0,0,.12);
    background:rgba(255,255,255,.6); color:var(--c-text); cursor:pointer; user-select:none; transition:all var(--trans);
    min-width: 44px; text-align:center; }
  .chip[data-active="true"]{ background:linear-gradient(180deg,var(--c-orange),#ff9800); color:#fff; border-color:transparent; box-shadow:var(--shadow-soft) }
  .k{font-weight:800; padding:4px 8px; border-radius:8px; background:rgba(0,0,0,.06)}
  .tag{font-size:12px; padding:6px 8px; border-radius:999px; background:rgba(0,0,0,.06)}
  .sep{height:1px; background:rgba(0,0,0,.08); margin:10px 0}
  footer{ position:fixed; bottom:0; left:0; right:0; background:linear-gradient(180deg,rgba(255,255,255,.2),rgba(255,255,255,.8));
    border-top:1px solid rgba(0,0,0,.06); backdrop-filter:saturate(1.2) blur(8px); z-index:65; }
  @media (prefers-color-scheme: dark){
    footer{ background:linear-gradient(180deg,rgba(20,24,38,.2),rgba(20,24,38,.8)); border-color:rgba(255,255,255,.08);}
  }
  .f-inner{max-width:980px; margin:0 auto; padding:10px 14px; display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap}
  .disclaimer{font-size:12px; color:var(--c-muted)}
  .sign{font-weight:800}
  .hidden{display:none !important}
  .center{display:flex; justify-content:center; align-items:center}
  .flex{display:flex}
  .right{margin-left:auto}
  .gap8{gap:8px} .gap12{gap:12px} .gap16{gap:16px}
  .pill{padding:6px 10px; border-radius:999px; background:rgba(0,0,0,.06); font-size:12px; display:flex; align-items:center; gap:6px}
  .note{font-size:12px; color:var(--c-muted)}
  .toast{ position:fixed; left:50%; transform:translateX(-50%) translateY(20px); bottom:80px; background:#222; color:#fff;
    padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none; transition: all .3s ease; z-index:70; max-width:90%; text-align:center; box-shadow:var(--shadow); }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
  #confetti{position:fixed; inset:0; pointer-events:none; z-index:40}
  .reduce-motion *{ transition-duration:0ms !important; animation: none !important }

  /* Hero */
  .hero{ position:relative; overflow:hidden; border-radius:18px;
    background: radial-gradient(600px 240px at 0% 0%, rgba(77,163,255,.25), transparent 60%),
                radial-gradient(600px 240px at 100% 0%, rgba(255,184,77,.25), transparent 60%),
                linear-gradient(180deg, #fff, #f8faff);
    padding:14px; }
  .hero .emoji{ font-size:48px; margin-right:8px; filter:saturate(1.1) }

  /* Section blocks */
  .section{border-radius:16px; padding:14px; background:var(--c-card); box-shadow:var(--shadow); margin:14px 0}
  .section .head{display:flex; align-items:center; gap:8px; font-weight:900; margin-bottom:10px}
  .head .h-emoji{font-size:22px}

  /* Axis bars */
  .axis-grid{display:grid; gap:12px}
  @media(min-width:700px){ .axis-grid{grid-template-columns:1fr 1fr; } }
  .axis-card{ padding:12px; border-radius:12px; background:linear-gradient(180deg,rgba(0,0,0,.04),rgba(0,0,0,.02));
    border:1px solid rgba(0,0,0,.06); box-shadow:var(--shadow-soft); position:relative; overflow:hidden; }
  .axis-title{display:flex; align-items:center; gap:8px; font-weight:700}
  .bar{position:relative; height:var(--bar-h); background:rgba(0,0,0,.08); border-radius:999px; overflow:hidden; margin-top:8px}
  .bar>i{position:absolute; inset:0; width:0%; border-radius:999px; background:linear-gradient(90deg,#8B77FF,#4DA3FF); }

  /* Enneagram visuals */
  .ennea-badge{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:14px;
    background:linear-gradient(180deg,rgba(0,0,0,.04),rgba(0,0,0,.02)); border:1px solid rgba(0,0,0,.06); font-weight:900;}
  .mini{font-size:12px; color:var(--c-muted)}
  .ennea-top3{display:grid; gap:8px}
  .e-row{display:flex; align-items:center; gap:10px}
  .e-row .lab{width:72px; font-weight:700}
  .e-row .e-bar{flex:1; height:10px; background:rgba(0,0,0,.08); border-radius:999px; overflow:hidden}
  .e-row .e-bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,#FFB84D,#FF6B6B)}
  .rep-grid{display:grid; gap:10px}
  @media(min-width:700px){ .rep-grid{grid-template-columns:1fr 1fr} }
  .rep-card{
    background:linear-gradient(180deg,rgba(0,0,0,.04),rgba(0,0,0,.02)); border-radius:14px; padding:12px; border:1px solid rgba(0,0,0,.06);
    transition: transform 240ms ease, box-shadow 240ms ease;
  }
  .rep-card:hover{ transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,.08) }
  .rep-title{font-weight:800; display:flex; align-items:center; gap:6px}
  .rep-emoji{font-size:18px}
  .rep-quote{font-style:italic; color:var(--c-muted); margin-top:4px}

  /* Pop-in */
  .pop{opacity:0; transform:translateY(8px); animation:pop .5s ease forwards}
  .pop.delay1{animation-delay:.05s}
  .pop.delay2{animation-delay:.1s}
  .pop.delay3{animation-delay:.15s}
  .pop.delay4{animation-delay:.2s}
  @keyframes pop{ to{opacity:1; transform:translateY(0)}}

  /* Music controls */
  select, input[type="range"]{ accent-color:#6c59f0; }
  .range{width:90px; height:28px}
  audio{ display:none }
</style>
</head>
<body>
<header>
  <div class="h-inner">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="title">Type spark 9+16</div>
        <div class="subtitle" data-i18n="appSubtitle">ä¹å‹è‡ªé€‚åº” + MBTIï½œç¦»çº¿å¯ç”¨ï½œä¸ç”¨äºè¯Šæ–­</div>
      </div>
    </div>
    <div class="tools">
      <div class="pill" role="group" aria-label="è¯­è¨€ Language">
        <button class="btn ghost" id="lang-zh">ä¸­</button>
        <button class="btn ghost" id="lang-en">EN</button>
      </div>
      <div class="pill">
        <span data-i18n="motion">åŠ¨æ•ˆ</span>ï¼š
        <button class="btn ghost" id="motion-standard" aria-pressed="true" data-i18n="motionStandard">æ ‡å‡†</button>
        <button class="btn ghost" id="motion-reduced" data-i18n="motionReduced">å¼±åŠ¨æ•ˆ</button>
      </div>
      <div class="pill" id="music-pill" role="group" aria-label="èƒŒæ™¯éŸ³ä¹">
        <span id="music-label">ğŸµ éŸ³ä¹</span>ï¼š
        <button class="btn ghost" id="music-toggle">å…³é—­</button>
        <span id="music-vol-label">éŸ³é‡</span>
        <input id="music-vol" class="range" type="range" min="0" max="100" value="20" />
      </div>
    </div>
  </div>
</header>

<!-- èƒŒæ™¯éŸ³ä¹ï¼šä½ æä¾›çš„ mp3ï¼Œé»˜è®¤å°è¯•è‡ªåŠ¨æ’­æ”¾ï¼›è‹¥è¢«æ‹¦æˆªåˆ™é™éŸ³è‡ªå¯å¹¶åœ¨é¦–æ¬¡äº¤äº’æ—¶æ·¡å…¥ -->
<audio id="bgm-audio" preload="auto" loop autoplay
  src="https://pfst.cf2.poecdn.net/base/audio/6ea57e7f519a82251db529eb0e29c8948110a73d979b01a6e830442775af8555"></audio>

<canvas id="confetti" class="hidden"></canvas>

<div class="wrap" id="app">
  <!-- Intro -->
  <section id="intro" class="card">
    <h2 style="margin:0 0 6px" data-i18n="welcomeTitle">æ¬¢è¿ï¼å…ˆå¡«å†™ä¿¡æ¯åå¼€å§‹</h2>
    <p class="muted" data-i18n="welcomeTip">è¯´æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè¯¾å ‚äº¤æµä¸è‡ªæˆ‘äº†è§£ï¼Œéè¯Šæ–­ã€‚å§“åä¸ç­çº§ä»…ç”¨äºç»“æœå±•ç¤ºã€‚ä¹å‹ä¸ºè‡ªé€‚åº”æ¨¡å¼ã€‚</p>
    <div class="grid cols-2">
      <div class="field">
        <label for="inp-name" data-i18n="name">å§“å</label>
        <input id="inp-name" type="text" placeholder="ä¾‹å¦‚ï¼šå¼ åŒå­¦" autocomplete="name" />
      </div>
      <div class="field">
        <label for="inp-class" data-i18n="class">ç­çº§</label>
        <input id="inp-class" type="text" placeholder="ä¾‹å¦‚ï¼šåˆä¸‰ï¼ˆ2ï¼‰ç­ / é«˜ä¸€ï¼ˆ5ï¼‰ç­" />
      </div>
    </div>
    <div class="field inline">
      <button class="btn" id="btn-start" data-i18n="start">å¼€å§‹ç­”é¢˜ â–¶</button>
      <span class="muted" id="mode-note" style="margin-left:6px" data-i18n="modeNote">æ¨¡å¼ï¼šä»…ä¿ç•™ä¹å‹â€œè‡ªé€‚åº”â€ï¼Œå…±çº¦ 35 é¢˜ã€‚</span>
    </div>
    <div class="sep"></div>
    <div class="disclaimer" data-i18n="disclaimerLong">
      å…è´£å£°æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè‡ªæˆ‘äº†è§£ä¸è¯¾å ‚äº¤æµï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–èƒ½åŠ›è¯„ä¼°ã€‚ç»“æœå—é¢˜é‡ä¸å½“ä¸‹çŠ¶æ€å½±å“ï¼Œä»…ä¾›å‚è€ƒï¼Œå‹¿è´´æ ‡ç­¾ã€‚ä»£è¡¨äººç‰©ä¸ºç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼Œä¸ä»£è¡¨ä»»ä½•å®˜æ–¹ç«‹åœºã€‚æ•°æ®ä¸è”ç½‘ã€ä¸è‡ªåŠ¨ä¸Šä¼ ã€‚
    </div>
  </section>

  <!-- Questions -->
  <section id="quiz" class="card hidden" aria-live="polite">
    <div class="field">
      <div class="flex" style="justify-content:space-between;align-items:center">
        <div class="muted"><strong data-i18n="answerAll">è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®</strong>ï¼ˆ<span data-i18n="adaptiveNote">ä¹å‹åŸºç¡€9é¢˜å®Œæˆåä¼šå‡ºç°è¿½é—®</span>ï¼‰</div>
        <div class="muted"><span id="count-ans">0</span>/35</div>
      </div>
      <div class="progress" aria-hidden="true"><i id="progress"></i></div>
    </div>
    <div id="q-list" class="grid"></div>
    <div class="field inline gap8">
      <button class="btn" id="btn-submit" data-i18n="submit">æäº¤å¹¶æŸ¥çœ‹ç»“æœ ğŸ‰</button>
      <button class="btn ghost" id="btn-scrollTop" data-i18n="scrollTop">å›åˆ°é¡¶éƒ¨</button>
      <button class="btn ghost" id="btn-jumpUnanswered" data-i18n="jumpUnanswered">è·³åˆ°æœªç­”</button>
      <button class="btn ghost hidden" id="btn-jumpNew" data-i18n="jumpNew">è·³åˆ°è¿½é—®</button>
    </div>
  </section>

  <!-- Result -->
  <section id="result" class="card hidden">
    <!-- HERO -->
    <div class="hero pop">
      <div class="flex" style="align-items:center; gap:10px;">
        <div class="emoji" id="ennea-emoji">ğŸ§­</div>
        <div class="result-type" id="ennea-title">1 æ”¹é©è€…</div>
        <div class="badges" style="display:flex; gap:8px; flex-wrap:wrap;">
          <span class="tag" id="name-class"></span>
          <span class="tag" id="tie-badge" hidden>è‡ªåŠ¨å¾®è°ƒå·²åº”ç”¨</span>
        </div>
        <div class="right">
          <button class="btn ghost" id="btn-retake" data-i18n="retake">é‡æ–°ä½œç­”</button>
        </div>
      </div>
      <div id="ennea-desc" class="muted" style="margin-top:8px"></div>
    </div>

    <!-- ENNEAGRAM -->
    <div class="section pop delay1">
      <div class="head"><span class="h-emoji">ğŸ§©</span><span data-i18n="enneaSection">ä¹å‹äººæ ¼æ¦‚è§ˆ</span></div>
      <div class="grid cols-2">
        <div>
          <div class="ennea-badge" id="ennea-badge">ğŸ§­ 1 æ”¹é©è€…</div>
          <div class="mini" id="ennea-sub">ä¸­å¿ƒï¼šè‚ ï¼ˆ8/9/1ï¼‰ï½œç¿¼ï¼š1w9ï½œæˆé•¿â†’7 å‹åŠ›â†’4</div>
          <div class="sep"></div>
          <div class="ennea-top3" id="ennea-top3"></div>
        </div>
        <div>
          <div class="head" style="margin-top:-2px"><span class="h-emoji">ğŸ§‘â€ğŸ¨</span><span id="persona-title">äººç‰©ç”»åƒ</span></div>
          <div id="ennea-persona" class="rep-card" style="margin-bottom:10px"></div>

          <div class="head" style="margin-top:8px"><span class="h-emoji">ğŸ­</span><span data-i18n="repEnnea">ä¹å‹ä»£è¡¨äººç‰©ï¼ˆä»…ä¾›å‚è€ƒï¼‰</span></div>
          <div id="rep-ennea" class="rep-grid"></div>
          <div class="note" data-i18n="repNote">æ³¨ï¼šç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼›ä¸ä»£è¡¨å®˜æ–¹ç«‹åœºã€‚</div>
        </div>
      </div>
    </div>

    <!-- TOGGLE MBTI -->
    <div class="field inline">
      <button class="btn secondary" id="btn-toggle-mbti" data-i18n="seeMBTI">æŸ¥çœ‹ MBTI ç»“æœ â–¶</button>
    </div>

    <!-- MBTI BLOCK -->
    <div id="mbti-block" class="hidden">
      <div class="section pop delay2">
        <div class="head"><span class="h-emoji">ğŸ”¤</span><span data-i18n="lettersTitle">è¿™4ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ</span></div>
        <div id="letters-wrap" class="grid"></div>
      </div>

      <div class="section pop delay3">
        <div class="head"><span class="h-emoji">ğŸ“Š</span><span data-i18n="axesTitle">MBTI ç»´åº¦å¼ºåº¦</span></div>
        <div class="axis-grid">
          <div class="axis-card">
            <div class="axis-title"><span class="a-emoji">ğŸ˜„ğŸ§˜</span> E vs I</div>
            <div class="bar"><i id="bar-EI"></i></div>
          </div>
          <div class="axis-card">
            <div class="axis-title"><span class="a-emoji">ğŸ”ğŸ’¡</span> S vs N</div>
            <div class="bar"><i id="bar-SN"></i></div>
          </div>
          <div class="axis-card">
            <div class="axis-title"><span class="a-emoji">âš™ï¸ğŸ’</span> T vs F</div>
            <div class="bar"><i id="bar-TF"></i></div>
          </div>
          <div class="axis-card">
            <div class="axis-title"><span class="a-emoji">ğŸ“…ğŸ²</span> J vs P</div>
            <div class="bar"><i id="bar-JP"></i></div>
          </div>
        </div>
      </div>

      <div class="section pop delay3">
        <div class="head"><span class="h-emoji">ğŸ­</span><span data-i18n="representatives">MBTI ä»£è¡¨äººç‰©ï¼ˆä»…ä¾›å‚è€ƒï¼‰</span></div>
        <div id="rep" class="rep-grid"></div>
        <div class="note" data-i18n="repNote">æ³¨ï¼šç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼›ä¸ä»£è¡¨å®˜æ–¹ç«‹åœºã€‚</div>
      </div>
    </div>

    <!-- COMBINED TIPS -->
    <div class="section pop delay4">
      <div class="head"><span class="h-emoji">ğŸ§°</span><span data-i18n="combinedTips">ç»¼åˆå»ºè®®ï¼ˆåŸºäºä¹å‹ + MBTIï¼‰</span></div>
      <ul id="tips-combined" style="margin:0 0 0 18px"></ul>
    </div>

    <div class="field inline gap8">
      <button class="btn secondary pop delay4" id="btn-share" data-i18n="makeShare">ç”Ÿæˆç»“æœå›¾ç‰‡</button>
    </div>

    <canvas id="share-canvas" class="hidden" width="900" height="1500" aria-hidden="true"></canvas>
  </section>
</div>

<footer>
  <div class="f-inner">
    <div class="disclaimer" id="footer-disclaimer">
      å…è´£å£°æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè‡ªæˆ‘äº†è§£ä¸è¯¾å ‚äº¤æµï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–èƒ½åŠ›è¯„ä¼°ã€‚ç»“æœå—é¢˜é‡ä¸å½“ä¸‹çŠ¶æ€å½±å“ï¼Œä»…ä¾›å‚è€ƒï¼Œå‹¿è´´æ ‡ç­¾ã€‚ä»£è¡¨äººç‰©ä¸ºç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼Œä¸ä»£è¡¨ä»»ä½•å®˜æ–¹ç«‹åœºã€‚æ•°æ®ä¸è”ç½‘ã€ä¸è‡ªåŠ¨ä¸Šä¼ ã€‚
    </div>
    <div class="sign">ç”± Hannah åˆ¶ä½œ</div>
  </div>
</footer>

<div class="toast" id="toast" role="status" aria-live="polite">å·²å¤åˆ¶</div>

<script>
/* -------- i18n -------- */
const i18n = {
  zh:{
    appSubtitle:"ä¹å‹è‡ªé€‚åº” + MBTIï½œç¦»çº¿å¯ç”¨ï½œä¸ç”¨äºè¯Šæ–­",
    welcomeTitle:"æ¬¢è¿ï¼å…ˆå¡«å†™ä¿¡æ¯åå¼€å§‹",
    welcomeTip:"è¯´æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè¯¾å ‚äº¤æµä¸è‡ªæˆ‘äº†è§£ï¼Œéè¯Šæ–­ã€‚å§“åä¸ç­çº§ä»…ç”¨äºç»“æœå±•ç¤ºã€‚ä¹å‹ä¸ºè‡ªé€‚åº”æ¨¡å¼ã€‚",
    name:"å§“å", class:"ç­çº§", start:"å¼€å§‹ç­”é¢˜ â–¶",
    modeNote:"æ¨¡å¼ï¼šä»…ä¿ç•™ä¹å‹â€œè‡ªé€‚åº”â€ï¼Œå…±çº¦ 35 é¢˜ã€‚",
    answerAll:"è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®", adaptiveNote:"ä¹å‹åŸºç¡€9é¢˜å®Œæˆåä¼šå‡ºç°è¿½é—®",
    submit:"æäº¤å¹¶æŸ¥çœ‹ç»“æœ ğŸ‰", scrollTop:"å›åˆ°é¡¶éƒ¨", jumpUnanswered:"è·³åˆ°æœªç­”", jumpNew:"è·³åˆ°è¿½é—®",
    retake:"é‡æ–°ä½œç­”", motion:"åŠ¨æ•ˆ", motionStandard:"æ ‡å‡†", motionReduced:"å¼±åŠ¨æ•ˆ",
    disclaimerLong:"å…è´£å£°æ˜ï¼šæœ¬æµ‹è¯„ä»…ç”¨äºè‡ªæˆ‘äº†è§£ä¸è¯¾å ‚äº¤æµï¼Œä¸æ„æˆå¿ƒç†è¯Šæ–­æˆ–èƒ½åŠ›è¯„ä¼°ã€‚ç»“æœå—é¢˜é‡ä¸å½“ä¸‹çŠ¶æ€å½±å“ï¼Œä»…ä¾›å‚è€ƒï¼Œå‹¿è´´æ ‡ç­¾ã€‚ä»£è¡¨äººç‰©ä¸ºç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼›ä¸ä»£è¡¨å®˜æ–¹ç«‹åœºã€‚æ•°æ®ä¸è”ç½‘ã€ä¸è‡ªåŠ¨ä¸Šä¼ ã€‚",
    lettersTitle:"è¿™4ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ", axesTitle:"MBTI ç»´åº¦å¼ºåº¦",
    representatives:"MBTI ä»£è¡¨äººç‰©ï¼ˆä»…ä¾›å‚è€ƒï¼‰", repEnnea:"ä¹å‹ä»£è¡¨äººç‰©ï¼ˆä»…ä¾›å‚è€ƒï¼‰", repNote:"æ³¨ï¼šç²‰ä¸å½’ç±»ï¼Œå­˜åœ¨å¤šç§è§£è¯»ï¼›ä¸ä»£è¡¨å®˜æ–¹ç«‹åœºã€‚",
    enneaSection:"ä¹å‹äººæ ¼æ¦‚è§ˆ", combinedTips:"ç»¼åˆå»ºè®®ï¼ˆåŸºäºä¹å‹ + MBTIï¼‰",
    seeMBTI:"æŸ¥çœ‹ MBTI ç»“æœ â–¶", hideMBTI:"æ”¶èµ· MBTI ç»“æœ â–²",
    music:"éŸ³ä¹", musicOn:"å¼€å¯", musicOff:"å…³é—­", volume:"éŸ³é‡",
    personaTitle:"äººç‰©ç”»åƒ",
    ennea:{
      title:(n, name)=>`${n} ${name}`, center:"ä¸­å¿ƒ", wing:"ç¿¼", growth:"æˆé•¿â†’", stress:"å‹åŠ›â†’", top3:"Top 3",
      centers:{gut:"è‚ ï¼ˆ8/9/1ï¼‰", heart:"å¿ƒï¼ˆ2/3/4ï¼‰", head:"å¤´ï¼ˆ5/6/7ï¼‰"},
      names:["æ”¹é©è€…","åŠ©äººè€…","å®å¹²è€…","æµªæ¼«è€…","æ€æƒ³è€…","å¿ è¯šè€…","ä¹å¤©è€…","æŒ‘æˆ˜è€…","å’Œå¹³è€…"],
      emojis:["ğŸ§­","ğŸ¤","ğŸ","ğŸ­","ğŸ”","ğŸ›¡ï¸","ğŸˆ","âš¡","ğŸ•Šï¸"]
    },
    share:{ title:"Type spark 9+16 ç»“æœå¡", left:"ä¹å‹äººæ ¼", right:"MBTI", center:"ä¸­å¿ƒ", wing:"ç¿¼", growth:"æˆé•¿", stress:"å‹åŠ›", tip:"è¦ç‚¹" },
    tieBadge:"è‡ªåŠ¨å¾®è°ƒå·²åº”ç”¨"
  },
  en:{
    appSubtitle:"Adaptive Enneagram + MBTI | Offline | Not diagnostic",
    welcomeTitle:"Welcome! Fill in info to begin",
    welcomeTip:"Note: Classroom reflection only. Name/Class are shown on your result. Enneagram is adaptive.",
    name:"Name", class:"Class", start:"Start â–¶",
    modeNote:"Mode: Enneagram 'Adaptive' only (~35 questions).",
    answerAll:"Please answer all questions", adaptiveNote:"Follow-up items appear after base 9 Enneagram items",
    submit:"Submit & See Results ğŸ‰", scrollTop:"Back to top", jumpUnanswered:"Jump to unanswered", jumpNew:"Jump to follow-ups",
    retake:"Retake", motion:"Motion", motionStandard:"Standard", motionReduced:"Reduced",
    disclaimerLong:"Disclaimer: For reflection only, not diagnostic. Fan-attributed reps; multiple interpretations. No uploads.",
    lettersTitle:"What do these 4 letters mean?", axesTitle:"MBTI Axes",
    representatives:"MBTI Representative Figures (for fun)", repEnnea:"Enneagram Representatives (for fun)", repNote:"Note: Fan-attributed; not official.",
    enneaSection:"Enneagram Overview", combinedTips:"Combined Tips (Enneagram + MBTI)",
    seeMBTI:"See MBTI â–¶", hideMBTI:"Hide MBTI â–²",
    music:"Music", musicOn:"On", musicOff:"Off", volume:"Vol",
    personaTitle:"Persona snapshot",
    ennea:{
      title:(n, name)=>`${n} ${name}`, center:"Center", wing:"Wing", growth:"Growthâ†’", stress:"Stressâ†’", top3:"Top 3",
      centers:{gut:"Gut (8/9/1)", heart:"Heart (2/3/4)", head:"Head (5/6/7)"},
      names:["Reformer","Helper","Achiever","Individualist","Investigator","Loyalist","Enthusiast","Challenger","Peacemaker"],
      emojis:["ğŸ§­","ğŸ¤","ğŸ","ğŸ­","ğŸ”","ğŸ›¡ï¸","ğŸˆ","âš¡","ğŸ•Šï¸"]
    },
    share:{ title:"Type spark 9+16 Result Card", left:"Enneagram", right:"MBTI", center:"Center", wing:"Wing", growth:"Growth", stress:"Stress", tip:"Key" },
    tieBadge:"Auto tie-break applied"
  }
};

/* -------- MBTI é¢˜åº“ -------- */
const MBTI_Q=[ /* çœç•¥æ³¨é‡Šï¼Œå®Œæ•´é¢˜åº“ä¿æŒä¸å˜ */ 
  {id:'M1', zh:"åœ¨ä¸€ç¾¤ä¸å¤ªç†Ÿçš„äººé‡Œï¼Œæˆ‘ä¹Ÿèƒ½å¾ˆå¿«èŠèµ·æ¥ã€‚", en:"In a group of unfamiliar people, I can strike up conversations quickly.", dim:"EI", side:"E", anchor:true},
  {id:'M2', zh:"å‚åŠ å®Œçƒ­é—¹æ´»åŠ¨åï¼Œæˆ‘éœ€è¦ä¸€ä¸ªäººå®‰é™ä¸€ä¼šå„¿ã€‚", en:"After lively events, I need quiet alone time to recharge.", dim:"EI", side:"I"},
  {id:'M3', zh:"å¬åˆ°ä¸€ä¸ªæ–°è¯é¢˜ï¼Œæˆ‘æ›´æ„¿æ„å…ˆè¯´è¯´çœ‹æ³•å†æ…¢æ…¢æƒ³ã€‚", en:"With a new topic, I tend to speak first and think it through as I go.", dim:"EI", side:"E"},
  {id:'M4', zh:"æœ‰ç©ºæ—¶ï¼Œæˆ‘æ›´å–œæ¬¢ç‹¬å¤„åšè‡ªå·±çš„å°å…´è¶£ã€‚", en:"In free time, I prefer solo hobbies over social activities.", dim:"EI", side:"I"},
  {id:'M5', zh:"é•¿æ—¶é—´ç‹¬å¤„ä¼šè®©æˆ‘æ„Ÿè§‰ç²¾åŠ›ä¸‹é™ã€‚", en:"Too much time alone drains my energy.", dim:"EI", side:"E"},
  {id:'M6', zh:"æˆ‘æ›´ä¿¡èµ–èƒ½è¢«è¯æ˜çš„äº‹å®ï¼Œè€Œä¸æ˜¯â€œçµæ„Ÿç›´è§‰â€ã€‚", en:"I trust verifiable facts more than flashes of intuition.", dim:"SN", side:"S"},
  {id:'M7', zh:"æˆ‘å¸¸å¸¸å…ˆæœ‰ä¸€ä¸ªæ•´ä½“æƒ³æ³•ï¼Œå†å»è¡¥ç»†èŠ‚ã€‚", en:"I often jump to a big picture idea and fill details later.", dim:"SN", side:"N", anchor:true},
  {id:'M8', zh:"åšè®¡åˆ’æ—¶ï¼Œæˆ‘å–œæ¬¢ä¸€æ­¥ä¸€æ­¥æŒ‰æµç¨‹æ¥ã€‚", en:"When planning, I prefer step-by-step procedures.", dim:"SN", side:"S"},
  {id:'M9', zh:"é¢å¯¹é¢˜ç›®ï¼Œæˆ‘ä¼šå…ˆæƒ³â€œè¿˜æœ‰æ²¡æœ‰æ›´ç‰¹åˆ«çš„åšæ³•â€ã€‚", en:"Facing a task, I first think: is there a more novel way?", dim:"SN", side:"N"},
  {id:'M10', zh:"ç›¸æ¯”ç°åœ¨ï¼Œæˆ‘æ›´è¢«æœªæ¥çš„å¯èƒ½æ€§æ‰€å¸å¼•ã€‚", en:"I'm more drawn to future possibilities than the present details.", dim:"SN", side:"N"},
  {id:'M11', zh:"åšå†³å®šæ—¶ï¼Œæˆ‘ä¼˜å…ˆè€ƒè™‘è§„åˆ™å’Œé€»è¾‘æ˜¯å¦ä¸€è‡´ã€‚", en:"When deciding, I prioritize consistency of rules and logic.", dim:"TF", side:"T"},
  {id:'M12', zh:"å¦‚æœä¸€ä¸ªåšæ³•ä¼šä¼¤å®³åˆ°åˆ«äººæ„Ÿå—ï¼Œæˆ‘ä¼šé‡æ–°æƒè¡¡ã€‚", en:"If a choice may hurt others' feelings, I reconsider.", dim:"TF", side:"F", anchor:true},
  {id:'M13', zh:"æ¥å—æ‰¹è¯„æ—¶ï¼Œæˆ‘æ›´æƒ³çŸ¥é“å…·ä½“äº‹å®ä¸è¯æ®ã€‚", en:"When criticized, I want concrete facts and evidence.", dim:"TF", side:"T"},
  {id:'M14', zh:"æˆ‘å¸¸æŠŠç»´æŠ¤å’Œè°å…³ç³»æ”¾åœ¨ç»“æœä¹‹å‰ã€‚", en:"I often prioritize harmony over outcomes.", dim:"TF", side:"F"},
  {id:'M15', zh:"å½“â€œåˆç†â€å’Œâ€œé¡¾åŠæ„Ÿå—â€å†²çªæ—¶ï¼Œæˆ‘ä¼šå°½é‡å¯»æ‰¾ä¸¤å…¨æ–¹æ¡ˆã€‚", en:"When logic and feelings conflict, I seek a both-win solution.", dim:"TF", side:"F"},
  {id:'M16', zh:"æˆ‘å–œæ¬¢å°½æ—©æŠŠäº‹æƒ…å®šä¸‹æ¥ï¼Œæœ‰æ˜ç¡®çš„æ—¶é—´è¡¨ã€‚", en:"I prefer to decide early and have a clear schedule.", dim:"JP", side:"J", anchor:true},
  {id:'M17', zh:"è®¡åˆ’è¢«æ‰“ä¹±æ—¶ï¼Œæˆ‘ä¹Ÿèƒ½è¿…é€Ÿå³å…´è°ƒæ•´ã€‚", en:"When plans change, I can adapt quickly and improvise.", dim:"JP", side:"P"},
  {id:'M18', zh:"æˆ‘ä¹ æƒ¯æŠŠä»»åŠ¡æå‰å®Œæˆï¼Œè€Œä¸æ˜¯æœ€åä¸€å¤©èµ¶ã€‚", en:"I tend to finish tasks early rather than at the last minute.", dim:"JP", side:"J"},
  {id:'M19', zh:"æˆ‘æ›´äº«å—ä¿æŒé€‰æ‹©çš„å¼€æ”¾ï¼Œè€Œä¸æ˜¯è¿‡æ—©å®šæ¡ˆã€‚", en:"I enjoy keeping options open rather than deciding too early.", dim:"JP", side:"P"},
  {id:'M20', zh:"é¢å¯¹ä½œä¸šï¼Œæˆ‘ä¼šå…ˆå¼€å·¥ï¼Œè¾¹åšè¾¹è°ƒæ•´æ–¹å‘ã€‚", en:"For assignments, I start and adjust direction as I go.", dim:"JP", side:"P"},
];

/* -------- ä¹å‹åŸºç¡€ -------- */
const EN_BASE=[
  {id:'E1', type:1, zh:"æˆ‘å¯¹å¯¹é”™ä¸æ”¹è¿›å¾ˆæ•æ„Ÿï¼Œçœ‹åˆ°é—®é¢˜ä¼šæƒ³ç«‹åˆ»ä¼˜åŒ–ã€‚", en:"I'm sensitive to right/wrong and feel driven to improve what's not working."},
  {id:'E2', type:2, zh:"æˆ‘ç»å¸¸ä¸»åŠ¨å¸®åŠ©åˆ«äººï¼Œå¾ˆåœ¨æ„å¯¹æ–¹æ˜¯å¦éœ€è¦æˆ‘ã€‚", en:"I naturally help others and care about being needed."},
  {id:'E3', type:3, zh:"æˆ‘ä»¥ç›®æ ‡ä¸æˆæœä¸ºå¯¼å‘ï¼Œå¸Œæœ›è¢«è®¤å¯ä¸ºé«˜æ•ˆèƒ½çš„äººã€‚", en:"I'm goal/results oriented and want to be seen as effective."},
  {id:'E4', type:4, zh:"æˆ‘å¾ˆé‡è§†ç‹¬ç‰¹ä¸çœŸå®çš„è‡ªæˆ‘è¡¨è¾¾ã€‚", en:"I value uniqueness and authentic self-expression."},
  {id:'E5', type:5, zh:"æˆ‘ä¼šå…ˆè§‚å¯Ÿä¸ç†è§£ï¼Œå†å†³å®šæ˜¯å¦æŠ•å…¥ç²¾åŠ›ã€‚", en:"I observe and understand first before investing energy."},
  {id:'E6', type:6, zh:"åšäº‹å‰æˆ‘ä¼šæƒ³é£é™©ä¸åå¤‡æ–¹æ¡ˆï¼Œé‡æ‰¿è¯ºä¸å¯é ã€‚", en:"I consider risks and backups; commitment and reliability matter."},
  {id:'E7', type:7, zh:"æˆ‘è¿½æ±‚æ–°é²œä¸è‡ªç”±ï¼Œå€¾å‘æŠŠæ³¨æ„åŠ›æ”¾åœ¨ç§¯æå¯èƒ½ã€‚", en:"I seek novelty and freedom, focusing on positive possibilities."},
  {id:'E8', type:8, zh:"æˆ‘ç›´é¢å†²çªï¼Œä¿æŠ¤å¼±è€…ï¼Œä¸å–œæ¬¢è¢«æ§åˆ¶ã€‚", en:"I face conflicts, protect the vulnerable, and dislike being controlled."},
  {id:'E9', type:9, zh:"æˆ‘å€¾å‘ç»´æŒå’Œæ°”ï¼Œä¸å–œæ¬¢äº‰æ‰§ï¼Œå®¹æ˜“é¡ºå…¶è‡ªç„¶ã€‚", en:"I keep the peace, avoid conflict, and go with the flow."},
];

/* -------- ä¹å‹è¿½é—® -------- */
const EN_FUP={
  1:[{id:'E1a', type:1, anchor:true, zh:"å½“æ ‡å‡†ä¸æ•ˆç‡å†²çªæ—¶ï¼Œæˆ‘ä»åšæŒæŒ‰åŸåˆ™æ¥ã€‚", en:"When standards and efficiency conflict, I stick to principles."},{id:'E1b', type:1, zh:"æˆ‘å¸¸ç»™è‡ªå·±ä¸ä»–äººè®¾å®šæ›´é«˜è¦æ±‚ã€‚", en:"I set higher standards for myself and others."}],
  2:[{id:'E2a', type:2, anchor:true, zh:"æˆ‘ä¼šä¼˜å…ˆä»–äººéœ€è¦ï¼Œå“ªæ€•ç‰ºç‰²è‡ªå·±çš„æ—¶é—´ã€‚", en:"I prioritize others' needs even at my own time's expense."},{id:'E2b', type:2, zh:"æœ‰äººæ‹’ç»å¸®åŠ©æ—¶æˆ‘ä¼šæœ‰ç‚¹å—æŒ«ã€‚", en:"I feel a bit hurt when my help is declined."}],
  3:[{id:'E3a', type:3, anchor:true, zh:"æˆ‘ä¼šè°ƒæ•´å½¢è±¡ä¸ç­–ç•¥ä»¥è¾¾æˆç›®æ ‡ã€‚", en:"I adapt image and strategy to achieve goals."},{id:'E3b', type:3, zh:"å®Œæˆä»»åŠ¡å¹¶è·å¾—è®¤å¯å¯¹æˆ‘å¾ˆé‡è¦ã€‚", en:"Accomplishing tasks and recognition matter to me."}],
  4:[{id:'E4a', type:4, anchor:true, zh:"æˆ‘èƒ½æ¸…æ¥šæ„ŸçŸ¥å¹¶è¡¨è¾¾ç»†è…»çš„æƒ…ç»ªã€‚", en:"I notice and express nuanced emotions clearly."},{id:'E4b', type:4, zh:"å½“æˆ‘è§‰å¾—å¹³åº¸æ—¶ä¼šæ˜æ˜¾å¤±è½ã€‚", en:"I feel down when I seem ordinary."}],
  5:[{id:'E5a', type:5, anchor:true, zh:"æˆ‘éœ€è¦è¶³å¤Ÿçš„çŸ¥è¯†ä¸èƒ½é‡å‚¨å¤‡æ‰å®‰å¿ƒè¡ŒåŠ¨ã€‚", en:"I need knowledge/energy reserves before acting."},{id:'E5b', type:5, zh:"æˆ‘ä¼šä¿æŒè¾¹ç•Œï¼Œé¿å…è¢«è¿‡åº¦æ‰“æ‰°ã€‚", en:"I keep boundaries to avoid being overextended."}],
  6:[{id:'E6a', type:6, anchor:true, zh:"æˆ‘å¸Œæœ›æœ‰æ˜ç¡®è§„åˆ™/æ‰¿è¯ºæ¥è®©æˆ‘å®‰å¿ƒã€‚", en:"Clear rules/commitments help me feel secure."},{id:'E6b', type:6, zh:"æˆ‘å¸¸åšâ€œå¦‚æœâ€¦é‚£å°±â€¦â€çš„æƒ…å¢ƒæ¼”ç»ƒã€‚", en:"I mentally rehearse 'if...then...' scenarios."}],
  7:[{id:'E7a', type:7, anchor:true, zh:"æˆ‘å€¾å‘å¿«é€Ÿè·³åˆ°æ›´æœ‰è¶£çš„é€‰æ‹©ä»¥é¿å…æ— èŠã€‚", en:"I switch to more interesting options to avoid boredom."},{id:'E7b', type:7, zh:"æˆ‘æ›´æ„¿æ„å°è¯•æ–°é²œäº‹ç‰©è€Œä¸æ˜¯æ·±æŒ–ä¸€ä¸ªã€‚", en:"I try new things rather than dig deep into one."}],
  8:[{id:'E8a', type:8, anchor:true, zh:"é¢å¯¹ä¸å…¬æˆ‘ä¼šç›´é¢å¹¶ç«™å‡ºæ¥æŠ—äº‰ã€‚", en:"I confront injustice and stand up against it."},{id:'E8b', type:8, zh:"æˆ‘ä¸å–œæ¬¢è¢«åˆ«äººæŒ‡æŒ¥å®‰æ’ã€‚", en:"I dislike being bossed around."}],
  9:[{id:'E9a', type:9, anchor:true, zh:"æˆ‘å¸¸å…ˆç…§é¡¾ä»–äººç«‹åœºä»¥é¿å…å†²çªã€‚", en:"I consider others' positions first to avoid conflict."},{id:'E9b', type:9, zh:"å¯¹æˆ‘æ¥è¯´ï¼Œèˆ’æœä¸ç¨³å®šå¾ˆé‡è¦ã€‚", en:"Comfort and stability are important to me."}]
};

/* -------- ä¹å‹ä»£è¡¨äººç‰© -------- */
const ENNEA_PROFILES={ /* å®Œæ•´å¯¹è±¡ï¼Œç•¥å»é‡å¤æ³¨é‡Šï¼Œå†…å®¹ä¸ä¸Šä¸€ç‰ˆä¸€è‡´ */ 
  1:{emoji:'ğŸ§­',name:{zh:'æ”¹é©è€…',en:'Reformer'},desc:{zh:"åŸåˆ™æ„Ÿå¼ºã€è¿½æ±‚æ­£ç¡®ä¸æ”¹è¿›ï¼Œçœ‹åˆ°é—®é¢˜ä¼šæƒ³ä¼˜åŒ–æµç¨‹ã€‚",en:"Principled, improvement-driven; fix what's not right."},reps:{zh:[{name:"èµ«æ• Hermione Granger",why:"å®ˆè§„åˆ™ã€è¿½æ±‚æ­£ç¡®ã€æ¨åŠ¨æ”¹è¿›ã€‚",quote:"æˆ‘ä»¬å¯èƒ½ä¼šè¢«å¼€é™¤ï¼"},{name:"åŒ…æ‹¯ï¼ˆåŒ…é’å¤©ï¼‰",why:"ç§‰å…¬æ‰§æ³•ã€é»‘ç™½åˆ†æ˜ã€‚",quote:"æ¸…æ­£ä¸ºæœ¬ã€‚"}],en:[{name:"Hermione Granger",why:"Rule-abiding, improvement-focused.",quote:"We could be expelled!"},{name:"Bao Zheng",why:"Upright and principled judge.",quote:"Integrity first."}]}},
  2:{emoji:'ğŸ¤',name:{zh:'åŠ©äººè€…',en:'Helper'},desc:{zh:"ä¹äºåŠ©äººï¼Œæ•æ„Ÿä»–äººéœ€è¦ï¼Œæ¸´æœ›è¢«éœ€è¦ä¸è¢«çˆ±ã€‚",en:"Caring and attuned to others' needs; want to be needed and loved."},reps:{zh:[{name:"å±±å§† Samwise",why:"åœ¨åœºç…§æ–™ï¼Œå®ˆæŠ¤ä¼™ä¼´ã€‚",quote:"æˆ‘ä¸èƒ½æ›¿ä½ èƒŒè´Ÿï¼Œä½†æˆ‘å¯ä»¥èƒŒç€ä½ ã€‚"},{name:"å—ä¸æ ¼å°”",why:"ä»¥è¡ŒåŠ¨å…³æ€€ä»–äººã€‚",quote:"æŠŠå–„æ„å˜æˆå®è·µã€‚"}],en:[{name:"Samwise Gamgee",why:"Present, caring, protective.",quote:"I can carry you."},{name:"Florence Nightingale",why:"Care through action.",quote:"Turn kindness into practice."}]}},
  3:{emoji:'ğŸ',name:{zh:'å®å¹²è€…',en:'Achiever'},desc:{zh:"ç›®æ ‡ä¸æˆæœå¯¼å‘ï¼Œé‡æ•ˆç‡ä¸è¡¨ç°ï¼Œå¸Œæœ›è¢«è®¤å¯ã€‚",en:"Goal/results-driven; value efficiency and recognition."},reps:{zh:[{name:"æ‰˜å°¼Â·æ–¯å¡”å…‹ Iron Man",why:"ç›®æ ‡æ¸…æ™°ã€ç»“æœè´Ÿè´£ã€è®²æ•ˆèƒ½ã€‚",quote:"æˆ‘å°±æ˜¯é’¢é“ä¾ ã€‚"},{name:"åˆ˜é‚¦",why:"åŠ¡å®æ•´åˆã€å–„ç”¨äººæ‰ã€‚",quote:"çŸ¥äººå–„ä»»ã€‚"}],en:[{name:"Tony Stark",why:"Outcome-focused, efficient.",quote:"I am Iron Man."},{name:"Liu Bang",why:"Pragmatic and resourceful.",quote:"Use the right people."}]}},
  4:{emoji:'ğŸ­',name:{zh:'æµªæ¼«è€…',en:'Individualist'},desc:{zh:"é‡ç‹¬ç‰¹ä¸çœŸå®ï¼Œæƒ…æ„Ÿæµ“åº¦é«˜ï¼Œè¡¨è¾¾è‡ªæˆ‘ã€‚",en:"Unique, authentic, emotionally expressive."},reps:{zh:[{name:"è‰¾è Elsa",why:"åšå›è‡ªå·±ã€çœŸå®è¡¨è¾¾ã€‚",quote:"éšå®ƒå§ã€‚"},{name:"ææ¸…ç…§",why:"ç»†è…»æ•æ„Ÿã€è‡ªæˆ‘è¡¨è¾¾ã€‚",quote:"å¯»å¯»è§…è§…ï¼Œå†·å†·æ¸…æ¸…ã€‚"}],en:[{name:"Elsa",why:"Be true to self.",quote:"Let it go."},{name:"Li Qingzhao",why:"Subtle, expressive.",quote:"Seeking and pondering."}]}},
  5:{emoji:'ğŸ”',name:{zh:'æ€æƒ³è€…',en:'Investigator'},desc:{zh:"çˆ±çŸ¥è¯†ä¸ç†è§£ï¼Œé‡è¾¹ç•Œä¸èƒ½é‡ä¿å­˜ã€‚",en:"Knowledge-seeking, analytical; value boundaries."},reps:{zh:[{name:"ç¦å°”æ‘©æ–¯ Sherlock Holmes",why:"é€»è¾‘æ¨ç†ã€è¯æ®è‡³ä¸Šã€‚",quote:"æ•°æ®ï¼ç»™æˆ‘æ•°æ®ï¼"},{name:"é’±é’Ÿä¹¦",why:"å­¦æœ¯æ°”è´¨ã€ä½“ç³»åŒ–æ€è€ƒã€‚",quote:"ä»¥ä¹¦ä¼šå‹ï¼Œäºæ€æˆå®¶ã€‚"}],en:[{name:"Sherlock Holmes",why:"Logic and evidence.",quote:"Data, data, data!"},{name:"Qian Zhongshu",why:"Scholarly, systematic.",quote:"Friends through books."}]}},
  6:{emoji:'ğŸ›¡ï¸',name:{zh:'å¿ è¯šè€…',en:'Loyalist'},desc:{zh:"é‡å®‰å…¨ä¸æ‰¿è¯ºï¼Œè¯„ä¼°é£é™©ï¼Œå®ˆæŠ¤å›¢é˜Ÿã€‚",en:"Security and commitment; assess risks; protect the team."},reps:{zh:[{name:"çº³å¨ Neville",why:"å…³é”®æ—¶åˆ»ç«™å‡ºæ¥ï¼Œå®ˆæŠ¤ä¼™ä¼´ã€‚",quote:"æˆ‘ä¼šç«™å‡ºæ¥ã€‚"},{name:"å²³é£",why:"ç²¾å¿ æŠ¥å›½ã€å®ˆæ‰¿è¯ºã€‚",quote:"ç²¾å¿ æŠ¥å›½ã€‚"}],en:[{name:"Neville Longbottom",why:"Stand up and defend.",quote:"I'll stand up to you."},{name:"Yue Fei",why:"Loyal and steadfast.",quote:"Utmost loyalty."}]}},
  7:{emoji:'ğŸˆ',name:{zh:'ä¹å¤©è€…',en:'Enthusiast'},desc:{zh:"è¿½æ±‚æ–°é²œä¸è‡ªç”±ï¼Œçµæ´»å³å…´ï¼Œå›é¿æ— èŠä¸ç—›è‹¦ã€‚",en:"Novelty and freedom; flexible, avoid boredom and pain."},reps:{zh:[{name:"æ°å…‹Â·æ–¯æ´¾ç½— Jack Sparrow",why:"æœºæ•å³å…´ã€ç©è½¬å±€é¢ã€‚",quote:"ä¸ºä»€ä¹ˆæœ—å§†æ²¡äº†ï¼Ÿ"},{name:"éŸ¦å°å®",why:"æœºçµæ¸¸èµ°ã€æŠŠäº‹å˜å¾—å¥½ç©ã€‚",quote:"èˆ¹åˆ°æ¡¥å¤´è‡ªç„¶ç›´ã€‚"}],en:[{name:"Jack Sparrow",why:"Witty and spontaneous.",quote:"Why is the rum gone?"},{name:"Wei Xiaobao",why:"Playful maneuvering.",quote:"It'll work out."}]}},
  8:{emoji:'âš¡',name:{zh:'æŒ‘æˆ˜è€…',en:'Challenger'},desc:{zh:"ç›´é¢å†²çªã€ä¸»å¼ è¾¹ç•Œï¼Œä¿æŠ¤å¼±è€…ï¼Œè¿½æ±‚æŒæ§ã€‚",en:"Confronting, boundary-setting, protective, in control."},reps:{zh:[{name:"ä¸¹å¦®è‰ä¸ Daenerys",why:"å¼ºåŠ¿ä¸»å¼ ã€æŠ¤å«å¼±è€…ã€‚",quote:"å±äºæˆ‘çš„ï¼Œæˆ‘ä¼šå–å›ã€‚"},{name:"é¡¹ç¾½",why:"åŠ›é‡åŸå‹ã€æ‹…å½“ã€‚",quote:"åŠ›æ‹”å±±å…®æ°”ç›–ä¸–ã€‚"}],en:[{name:"Daenerys Targaryen",why:"Forceful, protective.",quote:"I will take what is mine."},{name:"Xiang Yu",why:"Power and duty.",quote:"Unmatched might."}]}},
  9:{emoji:'ğŸ•Šï¸',name:{zh:'å’Œå¹³è€…',en:'Peacemaker'},desc:{zh:"è¿½æ±‚å’Œè°å®‰ç¨³ï¼Œç¼“å†²çŸ›ç›¾ï¼Œå®¹æ˜“è‡ªæˆ‘å¿½ç•¥ã€‚",en:"Harmony-seeking, steady, may self-forget."},reps:{zh:[{name:"å¤§ç™½ Baymax",why:"æ¸©å’ŒåŒ…å®¹ã€å®‰å¿ƒé™ªä¼´ã€‚",quote:"ç–¼ç—›æŒ‡æ•°ä»1åˆ°10ï¼Ÿ"},{name:"é˜¿ç”˜ Forrest Gump",why:"å¹³å’ŒåšéŸ§ã€é¡ºåŠ¿è€Œä¸ºã€‚",quote:"ç”Ÿæ´»å°±åƒä¸€ç›’å·§å…‹åŠ›ã€‚"}],en:[{name:"Baymax",why:"Gentle and buffering.",quote:"On a scale of 1 to 10..."},{name:"Forrest Gump",why:"Peaceful and resilient.",quote:"Life is like a box of chocolates."}]}}
};

/* -------- ä¹å‹äººç‰©ç”»åƒ -------- */
const ENNEA_PERSONA={
  zh:{
    1:"ä½ æ˜¯ä¸ªè®¤çœŸåˆæœ‰ä¸»è§çš„äººï¼šçœ‹è§ä¸å¯¹å°±æƒ³å˜å¥½ï¼Œåšäº‹è®²åŸåˆ™ï¼Œä½†ä¹Ÿåˆ«æŠŠè‡ªå·±é€¼å¤ªç´§å“¦ï½",
    2:"ä½ æ˜¯ä¸ªæš–å¿ƒå°å¤ªé˜³ï¼šæ€»èƒ½å‘ç°åˆ«äººéœ€è¦ï¼Œå‡ºæ‰‹ç›¸åŠ©ï¼›ä¹Ÿè¦è®°å¾—ç…§é¡¾å¥½è‡ªå·±ã€‚",
    3:"ä½ æ˜¯ä¸ªæ•ˆç‡ç‹ï¼šç›®æ ‡æ¸…æ™°ã€è¡ŒåŠ¨åŠ›å¼ºï¼›åšç»“æœåŒæ—¶ï¼Œç»™è¿‡ç¨‹ä¹Ÿç‚¹â€œå…‰â€ï½",
    4:"ä½ æ˜¯ä¸ªå¾ˆé…·çš„è¡¨è¾¾è€…ï¼šé‡è§†çœŸå®å’Œç‹¬ç‰¹ï¼Œæƒ…ç»ªç»†è…»ï¼›æŠŠæ„Ÿè§‰åŒ–æˆä½œå“è¶…åŠ åˆ†ã€‚",
    5:"ä½ æ˜¯ä¸ªå®‰é™çš„æ€è€ƒè€…ï¼šå…ˆæƒ³æ˜ç™½å†å‡ºæ‰‹ï¼Œèƒ½é‡ç®¡å¾—å¥½ï¼Œå‡ºæ‰‹å°±ç¨³ã€‚",
    6:"ä½ æ˜¯ä¸ªé è°±å®ˆæŠ¤è€…ï¼šä¼šæƒ³é£é™©å’Œé¢„æ¡ˆï¼Œå¤§å®¶éƒ½æ›´å®‰å¿ƒï¼›ä¹Ÿç»™è‡ªå·±ä¸€ç‚¹â€œè¯•é”™ç©ºé—´â€ã€‚",
    7:"ä½ æ˜¯ä¸ªå¿«ä¹æ¢ç´¢å®¶ï¼šå¥½å¥‡å¿ƒæ—ºç››ã€è¶…ä¼šæ‰¾ä¹å­ï¼›æŠŠå¥½å¥‡å˜æˆå°ä¸“é•¿æ›´å‰å®³ã€‚",
    8:"ä½ æ˜¯ä¸ªæœ‰åŠ›é‡çš„äººï¼šæ•¢è¯´æ•¢åšã€ä¼šä¿æŠ¤äººï¼›å¼ºåŠ¿ä¹Ÿå¯ä»¥æ¸©æŸ”è¡¨è¾¾ï¼Œæ•ˆæœæ›´å¥½ã€‚",
    9:"ä½ æ˜¯ä¸ªæ¸©æŸ”ç¨³å®šå™¨ï¼šä¼šåŒ–è§£çŸ›ç›¾ã€è®©äººèˆ’æœï¼›ä¹Ÿè¦æŠŠè‡ªå·±çš„æƒ³æ³•è¯´å‡ºæ¥ï½"
  },
  en:{
    1:"Youâ€™re firm and principled: spot a problem, fix it. Reminderâ€”progress > perfection!",
    2:"Youâ€™re a warm helper: quick to notice needs. Donâ€™t forget selfâ€‘care too.",
    3:"Youâ€™re a doer: clear goals, strong action. Shine a light on the process as well.",
    4:"Youâ€™re an expressive soul: authentic and unique. Turn feelings into creations.",
    5:"Youâ€™re a quiet thinker: understand first, then act. Manage energy like a pro.",
    6:"Youâ€™re a steady guardian: plan for risks, keep the team safe. Leave room to try.",
    7:"Youâ€™re an explorer: curious and fun. Grow one curiosity into a miniâ€‘specialty.",
    8:"Youâ€™re powerful: direct, protective. Soft tone + clear boundary = super effective.",
    9:"Youâ€™re a peacemaker: calm and comforting. Your voice mattersâ€”say it out loud."
  }
};

/* -------- å­—æ¯ä¿¡æ¯ä¸ç±»å‹è¡¨æƒ… -------- */
const LETTER_INFO={
  E:{emoji:'ğŸ˜„', en:'Extraversion', zh:'å¤–å‘', desc:{zh:'ä»ä¸äººäº’åŠ¨ä¸­â€œå……ç”µâ€ï¼Œå¸¸è¾¹è¯´è¾¹æƒ³ã€‚', en:'Energized by interaction; think while speaking.'}},
  I:{emoji:'ğŸ§˜', en:'Introversion', zh:'å†…å‘', desc:{zh:'ä»ç‹¬å¤„ä¸­â€œå……ç”µâ€ï¼Œå…ˆæƒ³å¥½å†å¼€å£ã€‚', en:'Energized by solitude; think before speaking.'}},
  S:{emoji:'ğŸ”', en:'Sensing', zh:'å®æ„Ÿ', desc:{zh:'é‡è§†ç°åœ¨ä¸ç»†èŠ‚ï¼Œè„šè¸å®åœ°ã€‚', en:'Focus on facts and details; grounded.'}},
  N:{emoji:'ğŸ’¡', en:'iNtuition', zh:'ç›´è§‰', desc:{zh:'å…³æ³¨å¯èƒ½æ€§ä¸å¤§å›¾æ™¯ï¼Œçˆ±è”æƒ³ã€‚', en:'See possibilities and the big picture.'}},
  T:{emoji:'âš™ï¸', en:'Thinking', zh:'æ€è€ƒ', desc:{zh:'ä¼˜å…ˆé€»è¾‘ä¸åŸåˆ™ï¼Œè®²é“ç†ã€‚', en:'Prioritize logic and principles.'}},
  F:{emoji:'ğŸ’', en:'Feeling', zh:'æƒ…æ„Ÿ', desc:{zh:'ä¼˜å…ˆäººå’Œæ„Ÿå—ï¼Œè®²å…±æƒ…ã€‚', en:'Prioritize people and feelings.'}},
  J:{emoji:'ğŸ“…', en:'Judging', zh:'åˆ¤æ–­', desc:{zh:'å–œæ¬¢å®šè®¡åˆ’ï¼Œæœ‰èŠ‚å¥åœ°æ¨è¿›ã€‚', en:'Prefer plans and structure.'}},
  P:{emoji:'ğŸ²', en:'Perceiving', zh:'æ„ŸçŸ¥', desc:{zh:'ä¿æŒçµæ´»ï¼Œè¾¹èµ°è¾¹è°ƒã€‚', en:'Prefer flexibility and spontaneity.'}},
};
const TYPE_EMOJIS={ ISTJ:'ğŸ›¡ï¸', ISFJ:'ğŸ¤', INFJ:'ğŸ”®', INTJ:'â™Ÿï¸', ISTP:'ğŸ› ï¸', ISFP:'ğŸ¨', INFP:'ğŸŒˆ', INTP:'ğŸ§ ', ESTP:'âš¡', ESFP:'ğŸ‰', ENFP:'âœ¨', ENTP:'ğŸš€', ESTJ:'ğŸ“£', ESFJ:'ğŸ¤', ENFJ:'ğŸŒŸ', ENTJ:'ğŸ†' };

/* -------- MBTI ä»£è¡¨äººç‰©ï¼ˆ16å‹å…¨è¦†ç›–ï¼‰ -------- */
const MBTI_PROFILES={ /* ä¸ä¸Šä¸€ç‰ˆä¸€è‡´ï¼Œæ­¤å¤„çœç•¥æ³¨é‡Š */ 
  ISTJ:{emoji:'ğŸ›¡ï¸',reps:{zh:[{name:"å²è’‚å¤«Â·ç½—æ°æ–¯ï¼ˆç¾é˜Ÿï¼‰",why:"å®ˆçºªå¾‹ã€å°½èŒè´£ã€é‡åŸåˆ™ä¸ç§©åºã€‚",quote:"æˆ‘å¯ä»¥ä¸€æ•´å¤©éƒ½è¿™æ ·ã€‚"}],en:[{name:"Steve Rogers (Captain America)",why:"Duty, discipline, principled.",quote:"I can do this all day."}]}},
  ISFJ:{emoji:'ğŸ¤',reps:{zh:[{name:"è«ä¸½Â·éŸ¦æ–¯è±",why:"ç…§æ–™ä¸å®ˆæŠ¤ã€è¸å®å¯é ã€‚",quote:"å®¶äººåœ¨ä¸€èµ·å°±æœ‰åŠ›é‡ã€‚"}],en:[{name:"Molly Weasley",why:"Caring, protective, dependable.",quote:"As long as weâ€™re together."}]}},
  INFJ:{emoji:'ğŸ”®',reps:{zh:[{name:"é‚“å¸ƒåˆ©å¤š",why:"æ´å¯Ÿäººå¿ƒã€å¼•å¯¼æˆé•¿ã€‚",quote:"é»‘æš—ä¸­ä¹Ÿèƒ½æ‰¾åˆ°å¹¸ç¦ã€‚"}],en:[{name:"Albus Dumbledore",why:"Insightful, guiding.",quote:"Happiness can be found even in the darkest of times."}]}},
  INTJ:{emoji:'â™Ÿï¸',reps:{zh:[{name:"å¥‡å¼‚åšå£«",why:"æˆ˜ç•¥ä¸ç³»ç»Ÿæ€ç»´ã€æ¼”ç®—æœªæ¥ã€‚",quote:"æˆ‘çœ‹è¿‡1400ä¸‡ç§å¯èƒ½ã€‚"}],en:[{name:"Doctor Strange",why:"Strategic, systems thinker.",quote:"14,000,605 outcomes."}]}},
  ISTP:{emoji:'ğŸ› ï¸',reps:{zh:[{name:"åŠ³æ‹‰Â·å…‹åŠ³é¦¥",why:"å†·é™åŠ¨æ‰‹ã€é—®é¢˜è§£å†³ã€‚",quote:"æœºä¼šæ˜¯è‡ªå·±åˆ›é€ çš„ã€‚"}],en:[{name:"Lara Croft",why:"Hands-on, problem-solver.",quote:"I make my own luck."}]}},
  ISFP:{emoji:'ğŸ¨',reps:{zh:[{name:"è±æˆˆæ‹‰æ–¯",why:"æ•é”æ„ŸçŸ¥ã€è¡ŒåŠ¨ä¼˜é›…ã€‚",quote:"çº¢æ—¥å‡èµ·ã€‚"}],en:[{name:"Legolas",why:"Perceptive, graceful action.",quote:"A red sun rises."}]}},
  INFP:{emoji:'ğŸŒˆ',reps:{zh:[{name:"ä½›ç½—å¤šÂ·å·´é‡‘æ–¯",why:"å¿ äºå†…å¿ƒä¸ç†æƒ³ã€å¯ŒåŒæƒ…å¿ƒã€‚",quote:"æˆ‘æ¥å¸¦ä¸Šè¿™æšæˆ’æŒ‡ã€‚"}],en:[{name:"Frodo Baggins",why:"Idealistic, compassionate.",quote:"I will take the Ring."}]}},
  INTP:{emoji:'ğŸ§ ',reps:{zh:[{name:"å°¼å¥¥",why:"è´¨ç–‘ç³»ç»Ÿã€è¿½å¯»çœŸç›¸ã€‚",quote:"æˆ‘ä¼šåŠŸå¤«äº†ã€‚"}],en:[{name:"Neo",why:"Questions systems, seeks truth.",quote:"I know Kung Fu."}]}},
  ESTP:{emoji:'âš¡',reps:{zh:[{name:"æ±‰Â·ç´¢ç½—",why:"æœºæ•æ•¢ä¸ºã€ç°åœºåº”å˜ã€‚",quote:"åˆ«å‘Šè¯‰æˆ‘æ¦‚ç‡ã€‚"}],en:[{name:"Han Solo",why:"Daring, quick on feet.",quote:"Never tell me the odds."}]}},
  ESFP:{emoji:'ğŸ‰',reps:{zh:[{name:"ç²¾çµï¼ˆé˜¿æ‹‰ä¸ï¼‰",why:"å¸¦åŠ¨æ°”æ°›ã€å³å…´åˆ›é€ ã€‚",quote:"ç¥åŠ›æ— è¾¹ï¼"}],en:[{name:"Genie (Aladdin)",why:"Energizing, improviser.",quote:"Phenomenal cosmic powers!"}]}},
  ENFP:{emoji:'âœ¨',reps:{zh:[{name:"èœ˜è››ä¾ ",why:"çƒ­å¿ƒåŠ©äººã€ç‚¹å­å¤šã€‚",quote:"èƒ½åŠ›è¶Šå¤§ï¼Œè´£ä»»è¶Šå¤§ã€‚"}],en:[{name:"Spiderâ€‘Man",why:"Helpful, witty, creative.",quote:"With great power comes great responsibility."}]}},
  ENTP:{emoji:'ğŸš€',reps:{zh:[{name:"æ‰˜å°¼Â·æ–¯å¡”å…‹",why:"ç‚¹å­å¿«ã€æ•¢é¢ è¦†ã€‚",quote:"æˆ‘å°±æ˜¯é’¢é“ä¾ ã€‚"}],en:[{name:"Tony Stark",why:"Inventive, disruptive.",quote:"I am Iron Man."}]}},
  ESTJ:{emoji:'ğŸ“£',reps:{zh:[{name:"èµ«æ•Â·æ ¼å…°æ°",why:"ç»„ç»‡åŠ›å¼ºã€é‡è§„åˆ™ä¸æ‰§è¡Œã€‚",quote:"æˆ‘ä»¬å¯èƒ½ä¼šè¢«å¼€é™¤ï¼"}],en:[{name:"Hermione Granger",why:"Organized, rules-focused.",quote:"We could be expelled!"}]}},
  ESFJ:{emoji:'ğŸ¤',reps:{zh:[{name:"è«å¦®å¡Â·ç›–å‹’",why:"ç»„ç»‡ä¸ç…§é¡¾ã€è¥é€ æ°›å›´ã€‚",quote:"è§„åˆ™è®©ä¹è¶£æ›´å°½å…´ï¼"}],en:[{name:"Monica Geller",why:"Organizing, caretaking.",quote:"Rules help control the fun!"}]}},
  ENFJ:{emoji:'ğŸŒŸ',reps:{zh:[{name:"å¢¨è²æ–¯",why:"é¼“èˆä¸å¼•å¯¼ã€è¿æ¥äººå¿ƒã€‚",quote:"æˆ‘åªèƒ½å¸¦ä½ åˆ°é—¨å£ã€‚"}],en:[{name:"Morpheus",why:"Inspiring guide, connector.",quote:"I can only show you the door."}]}},
  ENTJ:{emoji:'ğŸ†',reps:{zh:[{name:"è¾¾æ–¯Â·ç»´è¾¾",why:"ç›®æ ‡è‡³ä¸Šã€å¼ºåŠ¿é¢†å¯¼ã€‚",quote:"ä½ ç¼ºä¹ä¿¡å¿ƒè®©æˆ‘ä¸æ‚¦ã€‚"}],en:[{name:"Darth Vader",why:"Commanding, goal-first.",quote:"I find your lack of faith disturbing."}]}}
};

/* -------- ç»¼åˆå»ºè®®åº“ï¼ˆæ´»æ³¼å£è¯­ï¼‰ -------- */
const SUG_MBTI={
  zh:{
    E:["å¼€å£å‰æ•°3ç§’ï¼Œæƒ³å¥½3ä¸ªå…³é”®è¯ï¼Œå†è‡ªä¿¡å¼€éº¦ï¼","äººå¤šåœºåˆç…§é¡¾ä¸‹å®‰é™çš„åŒå­¦ï¼šç»™TA 1åˆ†é’Ÿæ€è€ƒæ—¶é—´ï½"],
    I:["å…ˆå†™å°å¡ç‰‡å†å‘è¨€æ›´å®‰å¿ƒã€‚åˆ«æ€¥ï¼Œæ…¢ä¸€ç‚¹ä¹Ÿå¾ˆé…·ã€‚","ç¤¾äº¤åç»™è‡ªå·±å……ç”µæ—¶é—´ï¼Œæ‰¾ä¸ªè§’è½å–˜å£æ°”å°±å¥½ã€‚"],
    S:["å…ˆæŠŠâ€œä¾‹é¢˜+æ­¥éª¤â€èµ°é¡ºï¼Œç»†èŠ‚åˆ«ä¸¢ï¼Œå†å¼€æ–°èŠ±æ ·ã€‚","åšç¬”è®°åˆ†ä¸‰ç±»ï¼šäº‹å®/æ•°æ®/æ­¥éª¤ï¼ŒæŸ¥èµ·æ¥è¶…å¿«ã€‚"],
    N:["å¥½ç‚¹å­è½åœ°æˆ3æ­¥å°è®¡åˆ’ï¼šä»Šå¤©èƒ½åšå“ªä¸€æ­¥ï¼Ÿ","è„‘æ´å¾ˆæ£’ï¼Œä¹Ÿè¦å®šæœŸâ€œç°å®æ£€è§†â€ä¸€ä¸‹å“¦ï½"],
    T:["è¯´ç»“è®ºæ—¶åŠ ä¸€å¥â€œå¯¹äººçš„å½±å“â€ï¼Œæ›´å…¨æ›´å‹å¥½ã€‚","ä¸¤æ¡åŸåˆ™+ä¸€æ¡ä¾‹å¤–ï¼Œç†æ€§åˆä¸æ­»æ¿ã€‚"],
    F:["å…ˆæ‡‚å¯¹æ–¹å†è¡¨è¾¾è‡ªå·±ï¼šå…ˆå¤è¿°ä¸€å¥â€œæˆ‘å¬åˆ°ä½ æ˜¯â€¦â€ã€‚","å…±æƒ…è¦é…ä¸¤æ¡å°äº‹å®ï¼Œæ¸©æŸ”åˆæœ‰ç†ã€‚"],
    J:["è®¡åˆ’ç•™10â€“20%ç¼“å†²ï¼Œä¸ç”¨æŠŠè¡¨æ’å¾—æ»¡æ»¡å½“å½“ã€‚","æŠŠå¤§ä»»åŠ¡æ‹†æˆå°å¡ç‰‡ï¼Œæ‰“å‹¾çš„ç¬é—´å¾ˆæ²»æ„ˆï½"],
    P:["å…ˆåšä¸ªå°æ ·ï¼ˆMVPï¼‰ï¼Œè¾¹åšè¾¹ä¼˜åŒ–ï¼Œä¸æ‹–å»¶ã€‚","è®¾ä¸€ä¸ªâ€œè½¯â€DDLï¼Œè½»è½»æ¨ä½ å¾€å‰èµ°ã€‚"]
  },
  en:{
    E:["Count 3, think 3 keywords, then go rock the mic!","In big groups, give quiet peers 1â€‘min think time."],
    I:["Jot a cue card before speakingâ€”slow is cool.","After social time, recharge yourself, then come back."],
    S:["Master examples + steps first; details matter!","Tag notes: facts/data/steps for quick review."],
    N:["Turn ideas into a 3â€‘step mini plan: do step 1 today.","Great imaginationâ€”do a reality check weekly."],
    T:["Add one line on people impactâ€”complete and kind.","Two principles + one exception = smart flexibility."],
    F:["Understand first, then speak: â€œI hear you saying...â€","Pair empathy with two factsâ€”warm and solid."],
    J:["Leave 10â€“20% buffer; no need to overpack your schedule.","Break big tasks into tiny cards. Crossing off feels great!"],
    P:["Build an MVP first, then iterateâ€”no more stalling.","Set a soft deadline to gently push yourself."]
  }
};
const SUG_EN={
  zh:{
    1:["åˆ«æŠŠè‡ªå·±æ‹‰æ»¡æ ¼ï¼Œ80åˆ†å…ˆäº¤ä¹Ÿå¾ˆæ£’ï¼","å¯¹äººè¯´æ ‡å‡†æ—¶ï¼Œè¯­æ°”æ”¾æ¾ä¸€ç‚¹ï¼Œæ•ˆæœæ›´å¥½ï½","ä»Šå¤©åªä¼˜åŒ–ä¸€å¤„ï¼Œç•™ç‚¹åŠ›æ°”ç»™æ˜å¤©ã€‚"],
    2:["å…ˆé—®ä¸€å¥â€œä½ éœ€è¦æˆ‘å¸®å¿™å—ï¼Ÿâ€å°Šé‡æ›´èµ°å¿ƒã€‚","æ¯å¤©ç»™è‡ªå·±ä¸€å°å—â€œåªä¸ºæˆ‘â€çš„æ—¶é—´ï½","è®¾è¾¹ç•Œå¯ä»¥ç”¨â€œæˆ‘éœ€è¦â€¦â€å¼€å¤´ï¼Œæ¸©æŸ”åˆæ¸…æ™°ã€‚"],
    3:["ç›®æ ‡OKåï¼ŒåŠ ä¸€ä¸ªâ€œè¿‡ç¨‹æ„Ÿâ€å°æ¸…å•ã€‚","å®‰æ’ä¸€ä»¶ä¸æˆç»©æ— å…³çš„å°å¼€å¿ƒã€‚","æŠŠçœŸè¯šåé¦ˆå½“ç¤¼ç‰©ï¼Œå¸®ä½ æ›´å¼ºã€‚"],
    4:["å…ˆç»™æƒ…ç»ªå–ä¸ªåå­—ï¼Œå†åŠ¨æ‰‹åšä¸€ä»¶å°äº‹ã€‚","ä½œå“å…ˆå‘å‡ºå»ï¼Œåˆ«æ— é™æ‰“ç£¨ã€‚","å†™ä¸‹3ä»¶â€œå·²ç»å¤Ÿå¥½çš„â€äº‹æƒ…ã€‚"],
    5:["æŠŠæƒ³æ³•è¯´ç»™ä¸€ä¸ªäººå¬ï¼Œæ€è·¯ä¼šæ›´ç¨³ã€‚","ç»™è‡ªå·±è®¾â€œèµ°å‡ºèµ„æ–™åº“â€çš„è¡ŒåŠ¨æé†’ã€‚","èƒ½é‡åˆ°30%ä¹Ÿèƒ½å…ˆè¯•è¯•å°æ­¥ã€‚"],
    6:["åˆ—ä¸€å¼ â€œæˆ‘å·²ç»æœ‰çš„èµ„æºâ€æ¸…å•ï¼Œå®‰å¿ƒå€¼+1ã€‚","ç»ƒä¹ â€œå°æ­¥å…ˆåšï¼Œå†éªŒè¯â€ã€‚","æŠŠâ€œå‡è®¾â€å’Œâ€œäº‹å®â€åˆ†å¼€å†™æ¸…æ¥šã€‚"],
    7:["åŒæ—¶è¿›è¡Œçš„é¡¹ç›®æœ€å¤š2ä¸ªï¼Œæ³¨æ„åŠ›æ›´é¦™ã€‚","æ¥ä¸ª25åˆ†é’Ÿç•ªèŒ„é’Ÿï¼Œæ·±æŒ–ä¹Ÿèƒ½ä¸Šå¤´ã€‚","è´´ä¸€å¼ â€œé”™è¿‡ä¹Ÿæ²¡äº‹â€ï¼Œç»™è‡ªå·±é™å‹ã€‚"],
    8:["é‡åˆ°å†²çªå…ˆåœ2åˆ†é’Ÿï¼Œåˆ«æ€¥ç€åˆšã€‚","è¯·æœ‹å‹ç»™ä½ â€œæŸ”è½¯ä¸€ç‚¹â€çš„åé¦ˆã€‚","ä¿æŠ¤åˆ«äººå¾ˆå¸…ï¼Œä¿æŠ¤è‡ªå·±ä¹Ÿä¸€æ ·é‡è¦ã€‚"],
    9:["æ¯å¤©ä¸»åŠ¨åšä¸€ä¸ªå°å†³å®šï¼Œè®­ç»ƒå­˜åœ¨æ„Ÿã€‚","è®¾é—¹é’Ÿæé†’è‡ªå·±â€œè¯´è¯´æˆ‘çš„æƒ³æ³•â€ã€‚","æŠŠè‡ªå·±çš„ä¼˜å…ˆçº§å†™åœ¨æ¸…å•æœ€ä¸Šé¢ã€‚"]
  },
  en:{
    1:["Donâ€™t overâ€‘pushâ€”ship at 80% today!","Share standards with a softer toneâ€”more effective.","Improve just one thing today, save fuel for tomorrow."],
    2:["Ask â€œDo you want help?â€ firstâ€”respect matters.","Keep a tiny â€˜just for meâ€™ slot every day.","Use â€œI need...â€ to set warm, clear boundaries."],
    3:["Add a process checklist to goals.","Do one joy thatâ€™s not about performance.","Treat honest feedback as a gift."],
    4:["Name the feeling, then take one tiny action.","Ship itâ€”no endless polishing.","List 3 things already good enough."],
    5:["Say your idea out loud to one person.","Add an â€˜outâ€‘ofâ€‘theâ€‘libraryâ€™ action reminder.","Act at 30% energy to test."],
    6:["List resources you already haveâ€”instant calm.","Try â€˜do first, then verifyâ€™ microâ€‘steps.","Separate assumptions from facts."],
    7:["Cap parallel projects at 2â€”focus power!","Use a 25â€‘min focus timer to deepâ€‘dive.","Post â€˜missing out is okayâ€™ to ease FOMO."],
    8:["Pause 2 minutes before clashingâ€”less heat.","Invite some â€˜soft feedbackâ€™.","Protect yourself while protecting others."],
    9:["Make one tiny decision dailyâ€”build presence.","Set an alarm: â€˜state my viewâ€™.","Put your priorities at the top."]
  }
};

/* -------- å·¥å…· -------- */
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const shuffle=a=>a.map(x=>[Math.random(),x]).sort((p,q)=>p[0]-q[0]).map(x=>x[1]);
const avg=arr=>arr.length?arr.reduce((a,b)=>a+b,0)/arr.length:0;
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
function showToast(msg){ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1500); }

/* -------- çŠ¶æ€ -------- */
const state={
  lang:'zh', motion:'standard',
  name:'', cls:'',
  answers:{},
  order:[],
  enneaBaseDone:false, enneaFollowAdded:false, enneaTop3:[],
  resultMBTI:null, resultEN:null,
  music:{enabled:true, volume:0.2}
};

/* -------- è¯­è¨€/åŠ¨æ•ˆ -------- */
function applyLang(){
  const dict=i18n[state.lang];
  $$('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n'); const parts=key.split('.'); let val=dict; for(const p of parts){ val=val?.[p]; }
    if(typeof val==='string') el.textContent=val;
  });
  $('#footer-disclaimer').textContent=dict.disclaimerLong;
  $$('.q-text').forEach(el=>{
    const id=el.getAttribute('data-id'); const meta=getQuestionMeta(id); if(!meta) return;
    el.textContent = state.lang==='zh' ? (meta.zh||'') : (meta.en||'');
  });
  $('#music-label').textContent=`ğŸµ ${dict.music}`;
  $('#music-vol-label').textContent=dict.volume;
  $('#music-toggle').textContent= state.music.enabled ? (dict.musicOff) : (dict.musicOn);
  $('#persona-title').textContent=dict.personaTitle;
  if(state.resultEN) renderEnnea();
  if(state.resultMBTI) renderMBTI();
}
function setLang(lang){ state.lang=lang; document.documentElement.lang=(lang==='zh'?'zh':'en'); applyLang(); showToast(lang==='zh'?'å·²åˆ‡æ¢ä¸ºä¸­æ–‡':'Switched to English'); }
function setMotion(mode){
  state.motion=mode;
  if(mode==='reduced' || matchMedia('(prefers-reduced-motion: reduce)').matches){ document.body.classList.add('reduce-motion'); }
  else document.body.classList.remove('reduce-motion');
}

/* -------- èƒŒæ™¯éŸ³ä¹ï¼šæ–¹æ¡ˆ B è‡ªåŠ¨æ’­æ”¾ï¼ˆé™éŸ³å›é€€ + é¦–æ¬¡äº¤äº’æ·¡å…¥ï¼‰ -------- */
const audioEl=document.getElementById('bgm-audio');
async function tryAutoplay(){
  try{
    audioEl.muted=false;
    audioEl.volume=clamp(state.music.volume,0,1);
    await audioEl.play();
    state.music.enabled=true;
  }catch(e){
    try{
      audioEl.muted=true;
      await audioEl.play();
      const onFirst=()=>{
        audioEl.muted=false;
        fadeVolumeTo(state.music.volume, 700);
        window.removeEventListener('pointerdown', onFirst);
        window.removeEventListener('keydown', onFirst);
      };
      window.addEventListener('pointerdown', onFirst, {once:true});
      window.addEventListener('keydown', onFirst, {once:true});
      state.music.enabled=true;
      showToast(state.lang==='zh'?'å·²é™éŸ³æ’­æ”¾ï¼Œé¦–æ¬¡ç‚¹å‡»åæ·¡å…¥':'Muted autoplay; will fade in on first interaction');
    }catch(err){
      state.music.enabled=false;
      showToast(state.lang==='zh'?'æµè§ˆå™¨é˜»æ­¢è‡ªåŠ¨æ’­æ”¾ï¼Œè¯·ç‚¹â€œå¼€å¯â€':'Autoplay blocked. Tap On to play');
    }
  }
}
function fadeVolumeTo(target, durMs=500){
  const start=audioEl.volume; const delta=target-start; const t0=performance.now();
  function step(t){ const p=clamp((t-t0)/durMs,0,1); audioEl.volume=start+delta*p; if(p<1) requestAnimationFrame(step); }
  requestAnimationFrame(step);
}

/* -------- æ¸²æŸ“é¢˜ç›® -------- */
function interleaveInitial(){
  const mbti=shuffle([...MBTI_Q]); const enb=shuffle([...EN_BASE]); const out=[];
  while(mbti.length || enb.length){ if(mbti.length) out.push({...mbti.shift(),kind:'MBTI'}); if(enb.length) out.push({...enb.shift(),kind:'EN'}); }
  state.order=out;
}
function getQuestionMeta(id){
  let meta=MBTI_Q.find(q=>q.id===id) || EN_BASE.find(q=>q.id===id);
  if(!meta){ for(const k of Object.keys(EN_FUP)){ const f=EN_FUP[k].find(q=>q.id===id); if(f){ meta=f; break; } } }
  return meta;
}
function renderQuestions(){
  interleaveInitial();
  const list=$('#q-list'); list.innerHTML='';
  state.order.forEach((q,idx)=>{ const card=createQCard(q,idx+1); list.appendChild(card); });
  updateProgress();
}
function createQCard(q,index){
  const card=document.createElement('div'); card.className='q-card card';
  card.setAttribute('data-id',q.id); card.setAttribute('data-kind',q.kind);
  if(q.kind==='EN' && q.new){ const b=document.createElement('div'); b.className='badge'; b.textContent='NEW'; card.appendChild(b); }
  const label=q.kind==='MBTI'?q.dim:`E${q.type||''}`.trim();
  card.innerHTML+=`
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
      <div><span class="k">Q${index}</span> <span class="q-text" data-id="${q.id}">${state.lang==='zh'?(q.zh||''):(q.en||'')}</span></div>
      <span class="tag">${label}</span>
    </div>
    <div class="scale" role="group" aria-label="Q${index}">
      ${[1,2,3,4,5].map(v=>`<span class="chip" data-q="${q.id}" data-val="${v}" role="button" tabindex="0">${scaleText(v)}</span>`).join('')}
    </div>`;
  card.querySelectorAll('.chip').forEach(ch=>{
    ch.addEventListener('click',()=>onChoose(ch));
    ch.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); onChoose(ch);} });
  });
  return card;
}
function scaleText(v){
  const m={zh:{1:"éå¸¸ä¸ç¬¦åˆ",2:"ä¸å¤ªç¬¦åˆ",3:"ä¸€èˆ¬/ä¸ç¡®å®š",4:"æ¯”è¾ƒç¬¦åˆ",5:"éå¸¸ç¬¦åˆ"},
           en:{1:"Strongly Disagree",2:"Disagree",3:"Neutral/Unsure",4:"Agree",5:"Strongly Agree"}};
  return m[state.lang][v];
}
function onChoose(ch){
  const qid=ch.getAttribute('data-q'); const val=+ch.getAttribute('data-val');
  state.answers[qid]=val;
  document.querySelectorAll(`.chip[data-q="${qid}"]`).forEach(c=>c.setAttribute('data-active','false'));
  ch.setAttribute('data-active','true');
  if(!state.enneaBaseDone){
    const baseDone=EN_BASE.every(q=>state.answers[q.id]>0);
    if(baseDone){ state.enneaBaseDone=true; addFollowups(); }
  }
  updateProgress();
}
function addFollowups(){
  const baseScores=computeEnScores(true);
  const pairs=Object.entries(baseScores.percent).map(([t,p])=>({t:+t,p})).sort((a,b)=>b.p-a.p);
  state.enneaTop3=pairs.slice(0,3).map(x=>x.t);

  const newQs=[]; state.enneaTop3.forEach(t=>{ const pack=EN_FUP[t]; if(Array.isArray(pack)){ pack.forEach(q=>newQs.push({...q,kind:'EN',new:true})); }});
  if(!newQs.length){ showToast(state.lang==='zh'?'æš‚æ— å¯ç”¨è¿½é—®é¢˜ï¼Œè¯·ç»§ç»­ä½œç­”':'No follow-up items available. Continue.'); return; }

  const list=$('#q-list'); const children=[...list.children];
  let mbtiTargets=children.filter(c=>c.getAttribute('data-kind')==='MBTI')
                          .filter(c=>{ const id=c.getAttribute('data-id'); return !state.answers[id]; });
  newQs.forEach((q,i)=>{
    const card=createQCard(q,state.order.length+i+1);
    if(mbtiTargets.length){ const tgt=mbtiTargets.shift(); tgt.insertAdjacentElement('afterend',card); }
    else list.appendChild(card);
    state.order.push(q);
  });
  state.enneaFollowAdded=true;
  $('#btn-jumpNew').classList.remove('hidden');
  showToast(state.lang==='zh'?'å·²ä¸ºä½ åŠ å…¥ 6 é“ä¹å‹è¿½é—®é¢˜':'6 follow-up Enneagram items added');
}

/* -------- è¿›åº¦ -------- */
function updateProgress(){
  const totalRequired=35;
  const answered=Object.keys(state.answers).length;
  $('#count-ans').textContent=Math.min(answered,totalRequired);
  $('#progress').style.width=`${Math.round(Math.min(answered,totalRequired)/totalRequired*100)}%`;
}

/* -------- è®¡ç®— MBTI -------- */
function computeMBTI(){
  const dims={ EI:{pos:'E',neg:'I',E:[],I:[]}, SN:{pos:'S',neg:'N',S:[],N:[]}, TF:{pos:'T',neg:'F',T:[],F:[]}, JP:{pos:'J',neg:'P',J:[],P:[]} };
  const missing=MBTI_Q.filter(q=>!state.answers[q.id]).map(q=>q.id);
  if(missing.length) return {error:true,missing};
  const result={letters:[], nets:{}, percents:{}, tieBreak:false, code:''};
  for(const key of ['EI','SN','TF','JP']){
    const d=dims[key];
    MBTI_Q.filter(q=>q.dim===key).forEach(q=>{ const v=state.answers[q.id]??3; const delta=v-3; d[q.side].push({id:q.id,v,delta}); });
    const net=d[d.pos].reduce((s,x)=>s+x.delta,0) - d[d.neg].reduce((s,x)=>s+x.delta,0);
    let letter;
    if(net>0) letter=d.pos; else if(net<0) letter=d.neg;
    else{
      const mp=avg(d[d.pos].map(x=>x.v)), mn=avg(d[d.neg].map(x=>x.v));
      if(mp!==mn) letter= mp>mn?d.pos:d.neg;
      else{ const anchor=MBTI_Q.find(q=>q.dim===key && q.anchor); const av=state.answers[anchor.id]??3;
            letter= av>3?anchor.side:(av<3?(anchor.side===d.pos?d.neg:d.pos):d.pos); }
      result.tieBreak=true;
    }
    result.letters.push(letter);
    const leftPct=Math.round((net+10)/20*100);
    result.percents[key]={[d.pos]:leftPct,[d.neg]:100-leftPct};
    result.nets[key]=net;
  }
  result.code=result.letters.join('');
  return result;
}

/* -------- è®¡ç®—ä¹å‹ -------- */
const EN_GROWTH={1:7,2:4,3:6,4:1,5:8,6:9,7:5,8:2,9:3};
const EN_STRESS={1:4,2:8,3:9,4:2,5:7,6:3,7:1,8:5,9:6};
function computeEnScores(baseOnly=false){
  const itemsByType={1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[]};
  EN_BASE.forEach(q=>itemsByType[q.type].push({id:q.id,w:1}));
  if(!baseOnly){
    state.order.filter(x=>x.kind==='EN' && x.new).forEach(q=>{
      const meta=getQuestionMeta(q.id);
      if(meta?.type){ itemsByType[meta.type].push({id:q.id,w: meta.anchor?1.2:1}); }
    });
  }
  const percents={}, raw={}, maxByType={};
  for(let t=1;t<=9;t++){
    const arr=itemsByType[t];
    const maxW=arr.reduce((s,it)=>s+it.w,0)*5;
    const sum=arr.reduce((s,it)=> s + (state.answers[it.id]||0)*it.w, 0);
    const pct=maxW>0? (sum/maxW*100):0;
    percents[t]=pct; raw[t]=sum; maxByType[t]=maxW;
  }
  return {percent:percents, raw, maxByType};
}
function computeEnneagram(){
  const baseOk=EN_BASE.every(q=>state.answers[q.id]>0);
  const fupList=state.order.filter(x=>x.kind==='EN' && x.new);
  const fupOk= fupList.length===6 && fupList.every(q=>state.answers[q.id]>0);
  if(!baseOk || !fupOk) return {error:true};
  const scores=computeEnScores(false);
  let pairs=Object.entries(scores.percent).map(([t,p])=>({t:+t,p})).sort((a,b)=>b.p-a.p);
  let tieBreakApplied=false;
  if(pairs.length>=2 && (pairs[0].p-pairs[1].p)<2 && state.resultMBTI){
    const adj=enneaTieAdjust(state.resultMBTI.letters); let usedSum=0;
    for(const a of pairs){ const add=adj[a.t]||0; if(add && usedSum<0.6){ a.p+=add; usedSum+=add; tieBreakApplied=true; } }
    pairs.sort((a,b)=>b.p-a.p);
  }
  const top3=pairs.slice(0,3);
  const centers={ gut:avg([scores.percent[8],scores.percent[9],scores.percent[1]]),
                  heart:avg([scores.percent[2],scores.percent[3],scores.percent[4]]),
                  head:avg([scores.percent[5],scores.percent[6],scores.percent[7]]) };
  const main=top3[0].t;
  const left=main===1?9:(main-1);
  const right=main===9?1:(main+1);
  const wl=scores.percent[left], wr=scores.percent[right];
  let wing= wl>wr?`${main}w${left}`:`${main}w${right}`;
  let wingNote= Math.abs(wl-wr)<5 ? (state.lang==='zh'?'åŒç¿¼å¯èƒ½':'both wings possible') : '';
  return { main, top3, centers, wing, wingNote, growth:EN_GROWTH[main], stress:EN_STRESS[main], percents:scores.percent, tieBreak:tieBreakApplied };
}
function enneaTieAdjust(letters){
  const map={ E:[7,3], I:[5,4], N:[4,7], S:[1,6], T:[1,5], F:[2,9], J:[1,3], P:[7,9] };
  const adj={}; letters.forEach(L=>{ (map[L]||[]).forEach(t=>{ adj[t]=(adj[t]||0)+0.15; }); });
  return adj;
}

/* -------- æäº¤ä¸æ¸²æŸ“ -------- */
function onSubmit(){
  if(!state.enneaBaseDone || !state.enneaFollowAdded){
    showToast(state.lang==='zh'?'ä¹å‹åŸºç¡€é¢˜å®Œæˆåä¼šå‡ºç°è¿½é—®ï¼Œè¯·ç»§ç»­ä½œç­”':'Follow-up Enneagram items will appear; please continue.');
    $('#btn-jumpNew').classList.toggle('hidden', !state.enneaFollowAdded);
    return;
  }
  const pending=state.order.filter(q=>!state.answers[q.id]);
  if(pending.length){ showToast(state.lang==='zh'?'è¿˜æœ‰æœªç­”é¢˜ç›®':'Some questions are unanswered'); return; }
  state.resultMBTI=computeMBTI();
  state.resultEN=computeEnneagram();
  if(state.resultMBTI.error || state.resultEN.error){ showToast(state.lang==='zh'?'è¿˜æœ‰æœªç­”é¢˜ç›®':'Some questions are unanswered'); return; }
  renderResults(); show('result');
}
function renderResults(){
  renderEnnea(); renderMBTI(); renderCombinedTips();
  if(state.motion!=='reduced' && !matchMedia('(prefers-reduced-motion: reduce)').matches) launchConfetti();
}
function renderEnnea(){
  const r=state.resultEN; const prof=ENNEA_PROFILES[r.main]; const dict=i18n[state.lang].ennea;
  $('#ennea-emoji').textContent=prof.emoji;
  $('#ennea-title').textContent=dict.title(r.main, prof.name[state.lang]);
  $('#name-class').textContent=`${i18n[state.lang].name||'å§“å'}: ${state.name} Â· ${i18n[state.lang].class||'ç­çº§'}: ${state.cls}`;
  $('#ennea-desc').textContent=prof.desc[state.lang];
  const c=r.centers; const maxKey=[['gut',c.gut],['heart',c.heart],['head',c.head]].sort((a,b)=>b[1]-a[1])[0][0];
  $('#ennea-badge').textContent=`${prof.emoji} ${r.main} ${prof.name[state.lang]}`;
  $('#ennea-sub').textContent=`${i18n[state.lang].ennea.center}ï¼š${i18n[state.lang].ennea.centers[maxKey]}ï½œ${i18n[state.lang].ennea.wing}ï¼š${r.wing}${r.wingNote?`ï¼ˆ${r.wingNote}ï¼‰`:''}ï½œ${i18n[state.lang].ennea.growth}${EN_GROWTH[r.main]}  ${i18n[state.lang].ennea.stress}${EN_STRESS[r.main]}`;
  const top3Div=$('#ennea-top3'); top3Div.innerHTML='';
  r.top3.forEach(it=>{
    const line=document.createElement('div'); line.className='e-row';
    const name=ENNEA_PROFILES[it.t].name[state.lang];
    line.innerHTML=`<div class="lab">${it.t} ${name}</div><div class="e-bar"><i style="width:${Math.round(it.p)}%"></i></div><div class="mini">${Math.round(it.p)}%</div>`;
    top3Div.appendChild(line);
  });
  const personaDiv=$('#ennea-persona');
  personaDiv.innerHTML=`<div class="rep-title"><span class="rep-emoji">ğŸ§‘â€ğŸ¨</span>${i18n[state.lang].personaTitle}</div>
                        <div class="muted" style="margin-top:6px">${ENNEA_PERSONA[state.lang][r.main]}</div>`;
  const reps=ENNEA_PROFILES[r.main].reps[state.lang]||[]; const repDiv=$('#rep-ennea'); repDiv.innerHTML='';
  reps.forEach((rp,i)=>{
    const em=['ğŸ¬','ğŸ“–','â­','ğŸ§­'][i%4];
    const card=document.createElement('div'); card.className='rep-card';
    card.innerHTML=`<div class="rep-title"><span class="rep-emoji">${em}</span>${rp.name}</div>
                    <div class="muted" style="margin-top:4px">${rp.why}</div>
                    <div class="rep-quote">â€œ${rp.quote}â€</div>`;
    repDiv.appendChild(card);
  });
  const tie=$('#tie-badge'); tie.hidden=!r.tieBreak; tie.textContent=i18n[state.lang].tieBadge;
}
function renderMBTI(){
  const r=state.resultMBTI; if(!r||r.error) return;
  const wrap=$('#letters-wrap'); wrap.innerHTML='';
  ['E','I','S','N','T','F','J','P'].forEach(L=>{
    const info=LETTER_INFO[L];
    const card=document.createElement('div'); card.className='section'; card.style.padding='10px 12px';
    card.innerHTML=`<div style="display:flex;align-items:center;gap:12px;">
      <div style="width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:26px;background:linear-gradient(180deg,#8B77FF,#4DA3FF)">${L}</div>
      <div><div style="font-weight:800">${info.emoji} ${L} Â· ${info.en} Â· ${info.zh}</div>
      <div class="muted" style="font-size:14px">${info.desc[state.lang]}</div></div></div>`;
    wrap.appendChild(card);
  });
  animateBar('#bar-EI', r.percents.EI.E/100, ['#8B77FF','#4DA3FF']);
  animateBar('#bar-SN', r.percents.SN.S/100, ['#4DA3FF','#FFB84D']);
  animateBar('#bar-TF', r.percents.TF.T/100, ['#66E3A4','#FF6B6B']);
  animateBar('#bar-JP', r.percents.JP.J/100, ['#FFB84D','#4DA3FF']);
  const code=r.code; const repDiv=$('#rep'); repDiv.innerHTML=''; const prof=MBTI_PROFILES[code]; const reps=prof?.reps?.[state.lang]||[];
  if(reps.length){
    reps.forEach((rp,i)=>{
      const em=['ğŸ¬','â­','ğŸ“–'][i%3];
      const card=document.createElement('div'); card.className='rep-card';
      card.innerHTML=`<div class="rep-title"><span class="rep-emoji">${em}</span>${rp.name}ï¼ˆ${code}ï¼‰</div>
                      <div class="muted" style="margin-top:4px">${rp.why}</div>
                      <div class="rep-quote">â€œ${rp.quote}â€</div>`;
      repDiv.appendChild(card);
    });
  }else{
    const card=document.createElement('div'); card.className='rep-card';
    card.innerHTML=`<div class="rep-title"><span class="rep-emoji">${TYPE_EMOJIS[code]||'âœ¨'}</span>${code}</div>
                    <div class="muted">${state.lang==='zh'?'ä½ çš„ MBTI ç±»å‹':'Your MBTI type'}</div>`;
    repDiv.appendChild(card);
  }
}
function renderCombinedTips(){
  const ul=$('#tips-combined'); ul.innerHTML=''; const lang=state.lang; const tips=[];
  (state.resultMBTI?.letters||[]).forEach(L=>{ (SUG_MBTI[lang][L]||[]).forEach(t=>tips.push(t)); });
  (SUG_EN[lang][state.resultEN.main]||[]).forEach(t=>tips.push(t));
  const out=[...new Set(tips)].slice(0,8);
  out.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.appendChild(li); });
}

/* -------- åŠ¨ç”»ä¸å½©å¸¦ -------- */
function animateBar(sel, ratio, colors){
  const el=document.querySelector(sel); if(!el) return;
  el.style.width='0%'; el.style.background=`linear-gradient(90deg, ${colors[0]}, ${colors[1]})`;
  setTimeout(()=>{ el.style.transition='width 900ms cubic-bezier(.2,.8,.2,1)'; el.style.width=`${Math.max(2,Math.round(ratio*100))}%`; },30);
}
function launchConfetti(){
  const canvas=$('#confetti'), ctx=canvas.getContext('2d');
  canvas.width=innerWidth; canvas.height=innerHeight; canvas.classList.remove('hidden');
  const colors=['#4DA3FF','#8B77FF','#FFB84D','#66E3A4','#ffd166','#ff6b6b','#FF6B9A'];
  const pieces=Array.from({length:140}).map(()=>({x:Math.random()*canvas.width,y:-20-Math.random()*canvas.height/2,w:6+Math.random()*6,h:10+Math.random()*10,c:colors[Math.floor(Math.random()*colors.length)],vY:2+Math.random()*3,vX:-1+Math.random()*2,rot:Math.random()*Math.PI,vr:-0.1+Math.random()*0.2}));
  let t=0,maxT=1800;
  function frame(){
    t+=16; ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p=>{ p.x+=p.vX; p.y+=p.vY; p.rot+=p.vr; if(p.y>canvas.height+30){p.y=-20; p.x=Math.random()*canvas.width;} ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.c; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore(); });
    if(t<maxT && state.motion!=='reduced') requestAnimationFrame(frame); else canvas.classList.add('hidden');
  }
  requestAnimationFrame(frame);
}

/* -------- åˆ†äº«å›¾ç‰‡ï¼ˆå‡è¡¡æ’ç‰ˆï¼‰ -------- */
const LETTER_SNAPS={ zh:{E:"çˆ±ç¤¾äº¤", I:"çˆ±ç‹¬å¤„", S:"çœ‹ç»†èŠ‚", N:"çœ‹å¯èƒ½", T:"è®²é“ç†", F:"é‡æ„Ÿå—", J:"çˆ±è®¡åˆ’", P:"æ›´çµæ´»"},
                     en:{E:"Social", I:"Solo", S:"Details", N:"Possibility", T:"Logic", F:"People", J:"Plan", P:"Flow"} };
$('#btn-share').addEventListener('click', ()=>{
  const W=900,H=1500; const canvasEl=$('#share-canvas'), ctx=canvasEl.getContext('2d');
  canvasEl.width=W; canvasEl.height=H; ctx.clearRect(0,0,W,H);
  const grad=ctx.createLinearGradient(0,0,0,H); grad.addColorStop(0,'#f6f8ff'); grad.addColorStop(1,'#fefaf5'); ctx.fillStyle=grad; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#2f2f33'; ctx.font='bold 40px system-ui'; ctx.fillText(i18n[state.lang].share.title, 40, 70);
  ctx.font='24px system-ui'; ctx.fillText(`${i18n[state.lang].name}: ${state.name}`, 40, 110);
  ctx.fillText(`${i18n[state.lang].class}: ${state.cls}`, 40, 145);

  // Left column
  const en=state.resultEN; const pe=ENNEA_PROFILES[en.main];
  let yL=190;
  ctx.font='bold 26px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(i18n[state.lang].share.left, 40, yL); yL+=20;
  ctx.font='bold 60px system-ui'; ctx.fillStyle='#ff8f00'; ctx.fillText(`${pe.emoji}  ${en.main} ${pe.name[state.lang]}`, 40, yL+50); yL+=70;
  ctx.font='18px system-ui'; ctx.fillStyle='#2f2f33';
  const centers=en.centers; const maxKey=[['gut',centers.gut],['heart',centers.heart],['head',centers.head]].sort((a,b)=>b[1]-a[1])[0][0];
  ctx.fillText(`${i18n[state.lang].share.center}: ${i18n[state.lang].ennea.centers[maxKey]}`, 40, yL+18);
  ctx.fillText(`${i18n[state.lang].share.wing}: ${en.wing}${en.wingNote?` (${en.wingNote})`:''}`, 40, yL+42);
  ctx.fillText(`${i18n[state.lang].share.growth}: ${EN_GROWTH[en.main]}   ${i18n[state.lang].share.stress}: ${EN_STRESS[en.main]}`, 40, yL+66);
  yL+=90;

  // Persona
  drawCard(ctx, 40, yL, 400, 110, '#fff');
  ctx.font='bold 18px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(state.lang==='zh'?'äººç‰©ç”»åƒ':'Persona', 55, yL+28);
  ctx.font='16px system-ui'; ctx.fillStyle='#2f2f33'; drawMultiline(ctx, ENNEA_PERSONA[state.lang][en.main], 55, yL+54, 370, 20);
  yL+=130;

  // Top3
  ctx.font='bold 18px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText('Top 3', 40, yL); yL+=10;
  en.top3.forEach((it,i)=>{
    yL+=36;
    const nm=ENNEA_PROFILES[it.t].name[state.lang];
    ctx.font='16px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(`${it.t} ${nm}`, 40, yL);
    drawBar(ctx, 150, yL-14, 260, 14, Math.max(0, Math.min(1, it.p/100)), '#FFB84D','#FF6B6B');
    ctx.fillStyle='#6b6f76'; ctx.font='14px system-ui'; ctx.fillText(`${Math.round(it.p)}%`, 420, yL);
  });
  yL+=30;

  // Left tips
  const leftTips=(SUG_EN[state.lang][en.main]||[]).slice(0,2);
  ctx.font='bold 18px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(state.lang==='zh'?'ä¹å‹å°æé†’':'Type Tips', 40, yL); yL+=26;
  leftTips.forEach((t,i)=>{ drawPill(ctx, 40, yL+i*32, t, '#2f2f33', '#e7f0ff'); });
  yL += leftTips.length*32 + 10;

  // Right column
  const mb=state.resultMBTI; const code=mb.code; let yR=190;
  ctx.font='bold 26px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(i18n[state.lang].share.right, 500, yR); yR+=20;
  ctx.font='bold 60px system-ui'; ctx.fillStyle='#8B77FF'; ctx.fillText(`${TYPE_EMOJIS[code]||'âœ¨'}  ${code}`, 500, yR+50); yR+=70;
  const bars=[
    {lab:'E / I', p:mb.percents.EI.E, colors:['#8B77FF','#4DA3FF']},
    {lab:'S / N', p:mb.percents.SN.S, colors:['#4DA3FF','#FFB84D']},
    {lab:'T / F', p:mb.percents.TF.T, colors:['#66E3A4','#FF6B6B']},
    {lab:'J / P', p:mb.percents.JP.J, colors:['#FFB84D','#4DA3FF']}
  ];
  ctx.font='16px system-ui'; ctx.fillStyle='#2f2f33';
  bars.forEach(b=>{ ctx.fillText(b.lab,500,yR); drawBar(ctx,560,yR-14,280,14,Math.max(0,Math.min(1,b.p/100)), b.colors[0], b.colors[1]); yR+=36; });

  // Letter snapshots
  yR+=10; ctx.font='bold 18px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(state.lang==='zh'?'å­—æ¯é€Ÿè¯»':'Letter Snapshots', 500, yR); yR+=16;
  const snaps=mb.letters.map(L=>`${L}Â·${LETTER_SNAPS[state.lang][L]}`); let sx=500, sy=yR+20; ctx.font='16px system-ui';
  snaps.forEach(txt=>{ drawPill(ctx, sx, sy, txt, '#2f2f33', '#efe9ff'); sx+= getTextWidth(ctx, txt)+26; if(sx>820){ sx=500; sy+=32; } });
  yR=sy+46;

  // MBTI rep
  const rep=(MBTI_PROFILES[code]?.reps?.[state.lang]||[])[0];
  if(rep){
    drawCard(ctx, 500, yR, 340, 120, '#fff');
    ctx.font='bold 18px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(state.lang==='zh'?'ä»£è¡¨äººç‰©':'Representative', 515, yR+28);
    ctx.font='16px system-ui'; drawMultiline(ctx, `${rep.name}ï½œ${rep.why}`, 515, yR+54, 310, 20);
    ctx.fillStyle='#6b6f76'; ctx.font='italic 14px system-ui'; drawMultiline(ctx, `â€œ${rep.quote}â€`, 515, yR+78, 310, 20);
    yR+=140;
  }

  // Bottom combined tips
  const tips=[]; (mb.letters||[]).forEach(L=>{ (SUG_MBTI[state.lang][L]||[]).forEach(t=>tips.push(t)); });
  (SUG_EN[state.lang][en.main]||[]).forEach(t=>tips.push(t));
  const combined=[...new Set(tips)].slice(0,6);
  let by=H-230; ctx.font='bold 20px system-ui'; ctx.fillStyle='#2f2f33'; ctx.fillText(state.lang==='zh'?'ä»Šå¤©å°±èƒ½ç”¨çš„å°è´´å£«':'Tips you can use today', 40, by); by+=16;
  let px=40, py=by+22; ctx.font='16px system-ui';
  combined.forEach(t=>{ const w=getTextWidth(ctx,t)+26; if(px+w>860){ px=40; py+=36; } drawPill(ctx, px, py, t, '#2f2f33', '#eaf7f0'); px+=w+10; });

  // Footer
  ctx.font='14px system-ui'; ctx.fillStyle='#6b6f76';
  const foot= state.lang==='zh' ? 'ç”± Hannah åˆ¶ä½œï½œä»…ä¾›å‚è€ƒ' : 'Made by Hannah | For reference only';
  ctx.fillText(foot, 40, H-40);

  canvasEl.classList.remove('hidden');
  const url=canvasEl.toDataURL('image/png');
  const a=document.createElement('a'); a.href=url; a.download=`Typespark_9plus16_${state.name}.png`; document.body.appendChild(a); a.click(); setTimeout(()=>a.remove(),0);
  showToast(state.lang==='zh'?'å·²ä¸‹è½½å›¾ç‰‡':'Image downloaded');
});
function drawBar(ctx,x,y,w,h,ratio,c1,c2){
  ctx.fillStyle='rgba(0,0,0,0.08)'; roundRect(ctx,x,y,w,h,9); ctx.fill();
  const gw=Math.max(2,Math.round(w*ratio)); const grad=ctx.createLinearGradient(x,0,x+w,0); grad.addColorStop(0,c1); grad.addColorStop(1,c2);
  ctx.fillStyle=grad; roundRect(ctx,x,y,gw,h,9); ctx.fill();
}
function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
function drawMultiline(ctx,text,x,y,maxW,lineH){ const chars=(text||'').split(''); let line='', yy=y;
  chars.forEach(ch=>{ const t=line+ch; if(ctx.measureText(t).width>maxW){ ctx.fillText(line,x,yy); yy+=lineH; line=ch; } else line=t; });
  if(line) ctx.fillText(line,x,yy);
}
function drawCard(ctx,x,y,w,h,bg='#fff'){ ctx.save(); ctx.shadowColor='rgba(0,0,0,0.08)'; ctx.shadowBlur=10; ctx.shadowOffsetY=6; ctx.fillStyle=bg; roundRect(ctx,x,y,w,h,14); ctx.fill(); ctx.restore(); }
function drawPill(ctx,x,y,text,color='#2f2f33',bg='#f1f5ff'){
  const padX=12; ctx.font='16px system-ui'; const tw=getTextWidth(ctx,text);
  ctx.fillStyle=bg; roundRect(ctx,x,y,tw+padX*2,28,14); ctx.fill();
  ctx.fillStyle=color; ctx.fillText(text, x+padX, y+20);
}
function getTextWidth(ctx,text){ return Math.ceil(ctx.measureText(text).width); }

/* -------- é¡µé¢åˆ‡æ¢ä¸äº‹ä»¶ -------- */
function show(sectionId){ ['intro','quiz','result'].forEach(id=>$('#'+id).classList.add('hidden')); $('#'+sectionId).classList.remove('hidden'); scrollTo({top:0,behavior:'smooth'}); }
function validateInfo(){
  state.name=$('#inp-name').value.trim(); state.cls=$('#inp-class').value.trim();
  if(!state.name){ showToast(state.lang==='zh'?'è¯·å¡«å†™å§“å':'Please enter your name'); return false; }
  if(!state.cls){ showToast(state.lang==='zh'?'è¯·å¡«å†™ç­çº§':'Please enter your class'); return false; }
  return true;
}
$('#btn-start').addEventListener('click', ()=>{ if(!validateInfo()) return; renderQuestions(); show('quiz'); });

$('#btn-scrollTop').addEventListener('click', ()=>scrollTo({top:0,behavior:'smooth'}));
$('#btn-jumpUnanswered').addEventListener('click', ()=>{
  for(const q of state.order){ if(!state.answers[q.id]){ const el=$(`.q-card[data-id="${q.id}"]`); el?.scrollIntoView({behavior:'smooth',block:'center'}); el?.querySelector('.chip')?.focus(); return; } }
  showToast(state.lang==='zh'?'å·²å…¨éƒ¨ä½œç­”':'All answered');
});
$('#btn-jumpNew').addEventListener('click', ()=>{
  const tgt=state.order.find(q=>q.kind==='EN' && q.new && !state.answers[q.id]);
  if(!tgt){ showToast(state.lang==='zh'?'è¿½é—®éƒ½å·²å®Œæˆ':'All follow-ups answered'); return; }
  const el=$(`.q-card[data-id="${tgt.id}"]`); if(el){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.querySelector('.chip')?.focus(); }
});
$('#btn-submit').addEventListener('click', onSubmit);
$('#btn-retake').addEventListener('click', ()=>{
  state.answers={}; state.order=[]; state.enneaBaseDone=false; state.enneaFollowAdded=false; state.enneaTop3=[];
  state.resultMBTI=null; state.resultEN=null;
  renderQuestions(); show('quiz');
});

/* -------- è¯­è¨€ä¸åŠ¨æ•ˆ -------- */
$('#lang-zh').addEventListener('click', ()=>setLang('zh'));
$('#lang-en').addEventListener('click', ()=>setLang('en'));
$('#motion-standard').addEventListener('click', ()=>{ setMotion('standard'); showToast(state.lang==='zh'?'å·²åˆ‡æ¢æ ‡å‡†åŠ¨æ•ˆ':'Standard motion on'); });
$('#motion-reduced').addEventListener('click', ()=>{ setMotion('reduced'); showToast(state.lang==='zh'?'å·²åˆ‡æ¢å¼±åŠ¨æ•ˆ':'Reduced motion on'); });

/* -------- éŸ³ä¹æ§åˆ¶ -------- */
const musicToggle=$('#music-toggle'), musicVol=$('#music-vol');
function updateMusicTexts(){ const dict=i18n[state.lang]; musicToggle.textContent = state.music.enabled ? dict.musicOff : dict.musicOn; }
musicToggle.addEventListener('click', async ()=>{
  state.music.enabled=!state.music.enabled;
  if(state.music.enabled){
    try{ audioEl.muted=false; audioEl.volume=clamp(state.music.volume,0,1); await audioEl.play(); fadeVolumeTo(state.music.volume, 300); }
    catch(e){ showToast(state.lang==='zh'?'æ’­æ”¾è¢«æ‹¦æˆªï¼Œè¯·å†ç‚¹ä¸€æ¬¡â€œå¼€å¯â€':'Playback blocked. Tap On again'); state.music.enabled=false; }
  }else{
    audioEl.pause();
  }
  updateMusicTexts();
});
musicVol.addEventListener('input', ()=>{
  const v=clamp(musicVol.value/100,0,1); state.music.volume=v; audioEl.volume=v;
});

/* -------- MBTI æŠ˜å  -------- */
$('#btn-toggle-mbti').addEventListener('click', ()=>{
  const b=$('#mbti-block'); const btn=$('#btn-toggle-mbti');
  const open=b.classList.contains('hidden'); b.classList.toggle('hidden', !open);
  btn.textContent= open ? i18n[state.lang].hideMBTI : i18n[state.lang].seeMBTI;
});

/* -------- åˆå§‹åŒ– -------- */
(function init(){
  setLang('zh');
  setMotion(matchMedia('(prefers-reduced-motion: reduce)').matches?'reduced':'standard');
  audioEl.volume=clamp(state.music.volume,0,1);
  tryAutoplay();
  updateMusicTexts();
})();
</script>
</body>
</html>
